£
JC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\ErrorViewModel.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 µ
FC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\Estimation.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 

Estimation 
{ 
[ 	
Key	 
] 
[		 	
DatabaseGenerated			 
(		 #
DatabaseGeneratedOption		 2
.		2 3
Identity		3 ;
)		; <
]		< =
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
double 
? 
EstimatedVolume &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[ 	
Required	 
( 
ErrorMessage 
=  
$str! E
)E F
]F G
public 
int 
NumberOfPeople !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
bool 
HasPool 
{ 
get !
;! "
set# &
;& '
}( )
public 
bool 
UsesDishwasher "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
Required	 
( 
ErrorMessage 
=  
$str! G
)G H
]H I
public 
int 
LaundryFrequency #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
Required	 
( 
ErrorMessage 
=  
$str! A
)A B
]B C
public 
int 
ShowerDuration !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
bool 
LeakDetection !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} ≥6
<C:\Users\21260\OneDrive\Documents\dotnet\waterprj\Program.cs
	namespace 	
waterprj
 
{ 
public 

class 
Program 
{		 
public 
static 
async 
Task  
Main! %
(% &
string& ,
[, -
]- .
args/ 3
)3 4
{ 	
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
var 
connectionString  
=! "
builder# *
.* +
Configuration+ 8
.8 9
GetConnectionString9 L
(L M
$strM `
)` a
;a b
builder 
. 
Services 
. 
AddDbContext )
<) * 
ApplicationDbContext* >
>> ?
(? @
options@ G
=>H J
options 
. 
UseSqlServer $
($ %
connectionString% 5
)5 6
)6 7
;7 8
builder 
. 
Services 
. 3
'AddDatabaseDeveloperPageExceptionFilter D
(D E
)E F
;F G
builder 
. 
Services 
. 
AddDefaultIdentity /
</ 0
IdentityUser0 <
>< =
(= >
options> E
=>F H
optionsI P
.P Q
SignInQ W
.W X#
RequireConfirmedAccountX o
=p q
falser w
)w x
. 
AddRoles 
< 
IdentityRole '
>' (
(( )
)) *
. $
AddEntityFrameworkStores )
<) * 
ApplicationDbContext* >
>> ?
(? @
)@ A
;A B
builder   
.   
Services   
.   #
AddControllersWithViews   4
(  4 5
)  5 6
;  6 7
var"" 
app"" 
="" 
builder"" 
."" 
Build"" #
(""# $
)""$ %
;""% &
if&& 
(&& 
app&& 
.&& 
Environment&& 
.&&  
IsDevelopment&&  -
(&&- .
)&&. /
)&&/ 0
{'' 
app(( 
.(( !
UseMigrationsEndPoint(( )
((() *
)((* +
;((+ ,
})) 
else** 
{++ 
app,, 
.,, 
UseExceptionHandler,, '
(,,' (
$str,,( 5
),,5 6
;,,6 7
app.. 
... 
UseHsts.. 
(.. 
).. 
;.. 
}// 
app11 
.11 
UseHttpsRedirection11 #
(11# $
)11$ %
;11% &
app22 
.22 
UseStaticFiles22 
(22 
)22  
;22  !
app44 
.44 

UseRouting44 
(44 
)44 
;44 
app66 
.66 
UseAuthentication66 !
(66! "
)66" #
;66# $
app77 
.77 
UseAuthorization77  
(77  !
)77! "
;77" #
app99 
.99 
MapControllerRoute99 "
(99" #
name:: 
::: 
$str:: 
,::  
pattern;; 
:;; 
$str;; A
);;A B
;;;B C
app<< 
.<< 
MapRazorPages<< 
(<< 
)<< 
;<<  
using>> 
(>> 
var>> 
scope>> 
=>> 
app>> "
.>>" #
Services>># +
.>>+ ,
CreateScope>>, 7
(>>7 8
)>>8 9
)>>9 :
{?? 
var@@ 
roleManager@@ 
=@@  !
scope@@" '
.@@' (
ServiceProvider@@( 7
.@@7 8
GetRequiredService@@8 J
<@@J K
RoleManager@@K V
<@@V W
IdentityRole@@W c
>@@c d
>@@d e
(@@e f
)@@f g
;@@g h
varAA 
rolesAA 
=AA 
newAA 
[AA  
]AA  !
{AA" #
$strAA$ +
,AA+ ,
$strAA- 3
}AA4 5
;AA5 6
foreachBB 
(BB 
varBB 
roleBB !
inBB" $
rolesBB% *
)BB* +
{CC 
ifDD 
(DD 
!DD 
awaitDD 
roleManagerDD *
.DD* +
RoleExistsAsyncDD+ :
(DD: ;
roleDD; ?
)DD? @
)DD@ A
awaitFF 
roleManagerFF )
.FF) *
CreateAsyncFF* 5
(FF5 6
newFF6 9
IdentityRoleFF: F
(FFF G
roleFFG K
)FFK L
)FFL M
;FFM N
}II 
}JJ 
usingMM 
(MM 
varMM 
scopeMM 
=MM 
appMM "
.MM" #
ServicesMM# +
.MM+ ,
CreateScopeMM, 7
(MM7 8
)MM8 9
)MM9 :
{NN 
varOO 
userManagerOO 
=OO  !
scopePP 
.PP 
ServiceProviderPP )
.PP) *
GetRequiredServicePP* <
<PP< =
UserManagerPP= H
<PPH I
IdentityUserPPI U
>PPU V
>PPV W
(PPW X
)PPX Y
;PPY Z
stringQQ 
emailQQ 
=QQ 
$strQQ +
;QQ+ ,
stringRR 
passwordRR 
=RR  !
$strRR" .
;RR. /
ifTT 
(TT 
awaitTT 
userManagerTT $
.TT$ %
FindByEmailAsyncTT% 5
(TT5 6
emailTT6 ;
)TT; <
==TT= ?
nullTT? C
)TTC D
{UU 
varVV 
userVV 
=VV 
newVV "
IdentityUserVV# /
(VV/ 0
)VV0 1
;VV1 2
userXX 
.XX 
UserNameXX !
=XX" #
emailXX$ )
;XX) *
userYY 
.YY 
EmailYY 
=YY  
emailYY! &
;YY& '
await[[ 
userManager[[ %
.[[% &
CreateAsync[[& 1
([[1 2
user[[2 6
,[[6 7
password[[8 @
)[[@ A
;[[A B
await]] 
userManager]] $
.]]$ %
AddToRoleAsync]]% 3
(]]3 4
user]]4 8
,]]8 9
$str]]: A
)]]A B
;]]B C
}__ 
}`` 
appcc 
.cc 
Runcc 
(cc 
)cc 
;cc 
}ee 	
}ff 
}gg ú
GC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\Consumption.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 
Consumption 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
UserId

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
[ 	
Display	 
( 
Name 
= 
$str 
) 
]  
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! @
)@ A
]A B
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
double 
Volume 
{ 
get "
;" #
set$ '
;' (
}) *
} 
public 

static 
class %
ClaimsPrincipalExtensions 1
{ 
public 
static 
string 
? 
	getUserId '
(' (
this( ,
ClaimsPrincipal- <
user= A
)A B
{ 	
if 
( 
user 
== 
null 
|| 
!  !
user! %
.% &
Identity& .
.. /
IsAuthenticated/ >
)> ?
{ 
return 
null 
; 
} 
var 
currentUser 
= 
user "
;" #
var 
nameIdentifierClaim #
=$ %
currentUser& 1
.1 2
	FindFirst2 ;
(; <

ClaimTypes< F
.F G
NameIdentifierG U
)U V
;V W
if   
(   
nameIdentifierClaim   #
==  $ &
null  ' +
)  + ,
{!! 
return"" 
null"" 
;"" 
}## 
return%% 
nameIdentifierClaim%% &
.%%& '
Value%%' ,
;%%, -
}&& 	
}'' 
}(( ´
iC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240329233741_UpdateEstimationModel.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class !
UpdateEstimationModel .
:/ 0
	Migration1 :
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} ∫%
gC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240317135916_estimationMigration.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
estimationMigration ,
:- .
	Migration/ 8
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Date 
= 
table  
.  !
Column! '
<' (
DateTime( 0
>0 1
(1 2
type2 6
:6 7
$str8 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
EstimatedVolume #
=$ %
table& +
.+ ,
Column, 2
<2 3
double3 9
>9 :
(: ;
type; ?
:? @
$strA H
,H I
nullableJ R
:R S
falseT Y
)Y Z
,Z [
NumberOfPeople "
=# $
table% *
.* +
Column+ 1
<1 2
int2 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
,T U
HasPool 
= 
table #
.# $
Column$ *
<* +
bool+ /
>/ 0
(0 1
type1 5
:5 6
$str7 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
UsesDishwasher "
=# $
table% *
.* +
Column+ 1
<1 2
bool2 6
>6 7
(7 8
type8 <
:< =
$str> C
,C D
nullableE M
:M N
falseO T
)T U
,U V
LaundryFrequency $
=% &
table' ,
., -
Column- 3
<3 4
int4 7
>7 8
(8 9
type9 =
:= >
$str? D
,D E
nullableF N
:N O
falseP U
)U V
,V W
ShowerDuration "
=# $
table% *
.* +
Column+ 1
<1 2
int2 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
,T U
LeakDetection !
=" #
table$ )
.) *
Column* 0
<0 1
bool1 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 4
,4 5
x6 7
=>8 :
x; <
.< =
Id= ?
)? @
;@ A
} 
) 
; 
}   	
	protected"" 
override"" 
void"" 
Down""  $
(""$ %
MigrationBuilder""% 5
migrationBuilder""6 F
)""F G
{## 	
migrationBuilder$$ 
.$$ 
	DropTable$$ &
($$& '
name%% 
:%% 
$str%% "
)%%" #
;%%# $
}&& 	
}'' 
}(( ‰
dC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240317124627_initialMigration.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
initialMigration )
:* +
	Migration, 5
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Date 
= 
table  
.  !
Column! '
<' (
DateTime( 0
>0 1
(1 2
type2 6
:6 7
$str8 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
Volume 
= 
table "
." #
Column# )
<) *
double* 0
>0 1
(1 2
type2 6
:6 7
$str8 ?
,? @
nullableA I
:I J
falseK P
)P Q
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str #
)# $
;$ %
}   	
}!! 
}"" ˛µ
hC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\00000000000000_CreateIdentitySchema.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class  
CreateIdentitySchema -
:. /
	Migration0 9
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
	maxLength0 9
:9 :
$num; >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
	maxLength: C
:C D
$numE H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
nullable< D
:D E
trueF J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
	maxLength4 =
:= >
$num? B
,B C
nullableD L
:L M
trueN R
)R S
,S T
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
Email   
=   
table   !
.  ! "
Column  " (
<  ( )
string  ) /
>  / 0
(  0 1
	maxLength  1 :
:  : ;
$num  < ?
,  ? @
nullable  A I
:  I J
true  K O
)  O P
,  P Q
NormalizedEmail!! #
=!!$ %
table!!& +
.!!+ ,
Column!!, 2
<!!2 3
string!!3 9
>!!9 :
(!!: ;
	maxLength!!; D
:!!D E
$num!!F I
,!!I J
nullable!!K S
:!!S T
true!!U Y
)!!Y Z
,!!Z [
EmailConfirmed"" "
=""# $
table""% *
.""* +
Column""+ 1
<""1 2
bool""2 6
>""6 7
(""7 8
nullable""8 @
:""@ A
false""B G
)""G H
,""H I
PasswordHash##  
=##! "
table### (
.##( )
Column##) /
<##/ 0
string##0 6
>##6 7
(##7 8
nullable##8 @
:##@ A
true##B F
)##F G
,##G H
SecurityStamp$$ !
=$$" #
table$$$ )
.$$) *
Column$$* 0
<$$0 1
string$$1 7
>$$7 8
($$8 9
nullable$$9 A
:$$A B
true$$C G
)$$G H
,$$H I
ConcurrencyStamp%% $
=%%% &
table%%' ,
.%%, -
Column%%- 3
<%%3 4
string%%4 :
>%%: ;
(%%; <
nullable%%< D
:%%D E
true%%F J
)%%J K
,%%K L
PhoneNumber&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
string&&/ 5
>&&5 6
(&&6 7
nullable&&7 ?
:&&? @
true&&A E
)&&E F
,&&F G 
PhoneNumberConfirmed'' (
='') *
table''+ 0
.''0 1
Column''1 7
<''7 8
bool''8 <
>''< =
(''= >
nullable''> F
:''F G
false''H M
)''M N
,''N O
TwoFactorEnabled(( $
=((% &
table((' ,
.((, -
Column((- 3
<((3 4
bool((4 8
>((8 9
(((9 :
nullable((: B
:((B C
false((D I
)((I J
,((J K

LockoutEnd)) 
=))  
table))! &
.))& '
Column))' -
<))- .
DateTimeOffset)). <
>))< =
())= >
nullable))> F
:))F G
true))H L
)))L M
,))M N
LockoutEnabled** "
=**# $
table**% *
.*** +
Column**+ 1
<**1 2
bool**2 6
>**6 7
(**7 8
nullable**8 @
:**@ A
false**B G
)**G H
,**H I
AccessFailedCount++ %
=++& '
table++( -
.++- .
Column++. 4
<++4 5
int++5 8
>++8 9
(++9 :
nullable++: B
:++B C
false++D I
)++I J
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 5
,//5 6
x//7 8
=>//9 ;
x//< =
.//= >
Id//> @
)//@ A
;//A B
}00 
)00 
;00 
migrationBuilder22 
.22 
CreateTable22 (
(22( )
name33 
:33 
$str33 (
,33( )
columns44 
:44 
table44 
=>44 !
new44" %
{55 
Id66 
=66 
table66 
.66 
Column66 %
<66% &
int66& )
>66) *
(66* +
nullable66+ 3
:663 4
false665 :
)66: ;
.77 

Annotation77 #
(77# $
$str77$ G
,77G H,
 SqlServerValueGenerationStrategy77I i
.77i j
IdentityColumn77j x
)77x y
,77y z
RoleId88 
=88 
table88 "
.88" #
Column88# )
<88) *
string88* 0
>880 1
(881 2
nullable882 :
:88: ;
false88< A
)88A B
,88B C
	ClaimType99 
=99 
table99  %
.99% &
Column99& ,
<99, -
string99- 3
>993 4
(994 5
nullable995 =
:99= >
true99? C
)99C D
,99D E

ClaimValue:: 
=::  
table::! &
.::& '
Column::' -
<::- .
string::. 4
>::4 5
(::5 6
nullable::6 >
:::> ?
true::@ D
)::D E
};; 
,;; 
constraints<< 
:<< 
table<< "
=><<# %
{== 
table>> 
.>> 

PrimaryKey>> $
(>>$ %
$str>>% :
,>>: ;
x>>< =
=>>>> @
x>>A B
.>>B C
Id>>C E
)>>E F
;>>F G
table?? 
.?? 

ForeignKey?? $
(??$ %
name@@ 
:@@ 
$str@@ F
,@@F G
columnAA 
:AA 
xAA  !
=>AA" $
xAA% &
.AA& '
RoleIdAA' -
,AA- .
principalTableBB &
:BB& '
$strBB( 5
,BB5 6
principalColumnCC '
:CC' (
$strCC) -
,CC- .
onDeleteDD  
:DD  !
ReferentialActionDD" 3
.DD3 4
CascadeDD4 ;
)DD; <
;DD< =
}EE 
)EE 
;EE 
migrationBuilderGG 
.GG 
CreateTableGG (
(GG( )
nameHH 
:HH 
$strHH (
,HH( )
columnsII 
:II 
tableII 
=>II !
newII" %
{JJ 
IdKK 
=KK 
tableKK 
.KK 
ColumnKK %
<KK% &
intKK& )
>KK) *
(KK* +
nullableKK+ 3
:KK3 4
falseKK5 :
)KK: ;
.LL 

AnnotationLL #
(LL# $
$strLL$ G
,LLG H,
 SqlServerValueGenerationStrategyLLI i
.LLi j
IdentityColumnLLj x
)LLx y
,LLy z
UserIdMM 
=MM 
tableMM "
.MM" #
ColumnMM# )
<MM) *
stringMM* 0
>MM0 1
(MM1 2
nullableMM2 :
:MM: ;
falseMM< A
)MMA B
,MMB C
	ClaimTypeNN 
=NN 
tableNN  %
.NN% &
ColumnNN& ,
<NN, -
stringNN- 3
>NN3 4
(NN4 5
nullableNN5 =
:NN= >
trueNN? C
)NNC D
,NND E

ClaimValueOO 
=OO  
tableOO! &
.OO& '
ColumnOO' -
<OO- .
stringOO. 4
>OO4 5
(OO5 6
nullableOO6 >
:OO> ?
trueOO@ D
)OOD E
}PP 
,PP 
constraintsQQ 
:QQ 
tableQQ "
=>QQ# %
{RR 
tableSS 
.SS 

PrimaryKeySS $
(SS$ %
$strSS% :
,SS: ;
xSS< =
=>SS> @
xSSA B
.SSB C
IdSSC E
)SSE F
;SSF G
tableTT 
.TT 

ForeignKeyTT $
(TT$ %
nameUU 
:UU 
$strUU F
,UUF G
columnVV 
:VV 
xVV  !
=>VV" $
xVV% &
.VV& '
UserIdVV' -
,VV- .
principalTableWW &
:WW& '
$strWW( 5
,WW5 6
principalColumnXX '
:XX' (
$strXX) -
,XX- .
onDeleteYY  
:YY  !
ReferentialActionYY" 3
.YY3 4
CascadeYY4 ;
)YY; <
;YY< =
}ZZ 
)ZZ 
;ZZ 
migrationBuilder\\ 
.\\ 
CreateTable\\ (
(\\( )
name]] 
:]] 
$str]] (
,]]( )
columns^^ 
:^^ 
table^^ 
=>^^ !
new^^" %
{__ 
LoginProvider`` !
=``" #
table``$ )
.``) *
Column``* 0
<``0 1
string``1 7
>``7 8
(``8 9
	maxLength``9 B
:``B C
$num``D G
,``G H
nullable``I Q
:``Q R
false``S X
)``X Y
,``Y Z
ProviderKeyaa 
=aa  !
tableaa" '
.aa' (
Columnaa( .
<aa. /
stringaa/ 5
>aa5 6
(aa6 7
	maxLengthaa7 @
:aa@ A
$numaaB E
,aaE F
nullableaaG O
:aaO P
falseaaQ V
)aaV W
,aaW X
ProviderDisplayNamebb '
=bb( )
tablebb* /
.bb/ 0
Columnbb0 6
<bb6 7
stringbb7 =
>bb= >
(bb> ?
nullablebb? G
:bbG H
truebbI M
)bbM N
,bbN O
UserIdcc 
=cc 
tablecc "
.cc" #
Columncc# )
<cc) *
stringcc* 0
>cc0 1
(cc1 2
nullablecc2 :
:cc: ;
falsecc< A
)ccA B
}dd 
,dd 
constraintsee 
:ee 
tableee "
=>ee# %
{ff 
tablegg 
.gg 

PrimaryKeygg $
(gg$ %
$strgg% :
,gg: ;
xgg< =
=>gg> @
newggA D
{ggE F
xggG H
.ggH I
LoginProviderggI V
,ggV W
xggX Y
.ggY Z
ProviderKeyggZ e
}ggf g
)ggg h
;ggh i
tablehh 
.hh 

ForeignKeyhh $
(hh$ %
nameii 
:ii 
$strii F
,iiF G
columnjj 
:jj 
xjj  !
=>jj" $
xjj% &
.jj& '
UserIdjj' -
,jj- .
principalTablekk &
:kk& '
$strkk( 5
,kk5 6
principalColumnll '
:ll' (
$strll) -
,ll- .
onDeletemm  
:mm  !
ReferentialActionmm" 3
.mm3 4
Cascademm4 ;
)mm; <
;mm< =
}nn 
)nn 
;nn 
migrationBuilderpp 
.pp 
CreateTablepp (
(pp( )
nameqq 
:qq 
$strqq '
,qq' (
columnsrr 
:rr 
tablerr 
=>rr !
newrr" %
{ss 
UserIdtt 
=tt 
tablett "
.tt" #
Columntt# )
<tt) *
stringtt* 0
>tt0 1
(tt1 2
nullablett2 :
:tt: ;
falsett< A
)ttA B
,ttB C
RoleIduu 
=uu 
tableuu "
.uu" #
Columnuu# )
<uu) *
stringuu* 0
>uu0 1
(uu1 2
nullableuu2 :
:uu: ;
falseuu< A
)uuA B
}vv 
,vv 
constraintsww 
:ww 
tableww "
=>ww# %
{xx 
tableyy 
.yy 

PrimaryKeyyy $
(yy$ %
$stryy% 9
,yy9 :
xyy; <
=>yy= ?
newyy@ C
{yyD E
xyyF G
.yyG H
UserIdyyH N
,yyN O
xyyP Q
.yyQ R
RoleIdyyR X
}yyY Z
)yyZ [
;yy[ \
tablezz 
.zz 

ForeignKeyzz $
(zz$ %
name{{ 
:{{ 
$str{{ E
,{{E F
column|| 
:|| 
x||  !
=>||" $
x||% &
.||& '
RoleId||' -
,||- .
principalTable}} &
:}}& '
$str}}( 5
,}}5 6
principalColumn~~ '
:~~' (
$str~~) -
,~~- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
table
ÄÄ 
.
ÄÄ 

ForeignKey
ÄÄ $
(
ÄÄ$ %
name
ÅÅ 
:
ÅÅ 
$str
ÅÅ E
,
ÅÅE F
column
ÇÇ 
:
ÇÇ 
x
ÇÇ  !
=>
ÇÇ" $
x
ÇÇ% &
.
ÇÇ& '
UserId
ÇÇ' -
,
ÇÇ- .
principalTable
ÉÉ &
:
ÉÉ& '
$str
ÉÉ( 5
,
ÉÉ5 6
principalColumn
ÑÑ '
:
ÑÑ' (
$str
ÑÑ) -
,
ÑÑ- .
onDelete
ÖÖ  
:
ÖÖ  !
ReferentialAction
ÖÖ" 3
.
ÖÖ3 4
Cascade
ÖÖ4 ;
)
ÖÖ; <
;
ÖÖ< =
}
ÜÜ 
)
ÜÜ 
;
ÜÜ 
migrationBuilder
àà 
.
àà 
CreateTable
àà (
(
àà( )
name
ââ 
:
ââ 
$str
ââ (
,
ââ( )
columns
ää 
:
ää 
table
ää 
=>
ää !
new
ää" %
{
ãã 
UserId
åå 
=
åå 
table
åå "
.
åå" #
Column
åå# )
<
åå) *
string
åå* 0
>
åå0 1
(
åå1 2
nullable
åå2 :
:
åå: ;
false
åå< A
)
ååA B
,
ååB C
LoginProvider
çç !
=
çç" #
table
çç$ )
.
çç) *
Column
çç* 0
<
çç0 1
string
çç1 7
>
çç7 8
(
çç8 9
	maxLength
çç9 B
:
ççB C
$num
ççD G
,
ççG H
nullable
ççI Q
:
ççQ R
false
ççS X
)
ççX Y
,
ççY Z
Name
éé 
=
éé 
table
éé  
.
éé  !
Column
éé! '
<
éé' (
string
éé( .
>
éé. /
(
éé/ 0
	maxLength
éé0 9
:
éé9 :
$num
éé; >
,
éé> ?
nullable
éé@ H
:
ééH I
false
ééJ O
)
ééO P
,
ééP Q
Value
èè 
=
èè 
table
èè !
.
èè! "
Column
èè" (
<
èè( )
string
èè) /
>
èè/ 0
(
èè0 1
nullable
èè1 9
:
èè9 :
true
èè; ?
)
èè? @
}
êê 
,
êê 
constraints
ëë 
:
ëë 
table
ëë "
=>
ëë# %
{
íí 
table
ìì 
.
ìì 

PrimaryKey
ìì $
(
ìì$ %
$str
ìì% :
,
ìì: ;
x
ìì< =
=>
ìì> @
new
ììA D
{
ììE F
x
ììG H
.
ììH I
UserId
ììI O
,
ììO P
x
ììQ R
.
ììR S
LoginProvider
ììS `
,
ìì` a
x
ììb c
.
ììc d
Name
ììd h
}
ììi j
)
ììj k
;
ììk l
table
îî 
.
îî 

ForeignKey
îî $
(
îî$ %
name
ïï 
:
ïï 
$str
ïï F
,
ïïF G
column
ññ 
:
ññ 
x
ññ  !
=>
ññ" $
x
ññ% &
.
ññ& '
UserId
ññ' -
,
ññ- .
principalTable
óó &
:
óó& '
$str
óó( 5
,
óó5 6
principalColumn
òò '
:
òò' (
$str
òò) -
,
òò- .
onDelete
ôô  
:
ôô  !
ReferentialAction
ôô" 3
.
ôô3 4
Cascade
ôô4 ;
)
ôô; <
;
ôô< =
}
öö 
)
öö 
;
öö 
migrationBuilder
úú 
.
úú 
CreateIndex
úú (
(
úú( )
name
ùù 
:
ùù 
$str
ùù 2
,
ùù2 3
table
ûû 
:
ûû 
$str
ûû )
,
ûû) *
column
üü 
:
üü 
$str
üü  
)
üü  !
;
üü! "
migrationBuilder
°° 
.
°° 
CreateIndex
°° (
(
°°( )
name
¢¢ 
:
¢¢ 
$str
¢¢ %
,
¢¢% &
table
££ 
:
££ 
$str
££ $
,
££$ %
column
§§ 
:
§§ 
$str
§§ (
,
§§( )
unique
•• 
:
•• 
true
•• 
,
•• 
filter
¶¶ 
:
¶¶ 
$str
¶¶ 6
)
¶¶6 7
;
¶¶7 8
migrationBuilder
®® 
.
®® 
CreateIndex
®® (
(
®®( )
name
©© 
:
©© 
$str
©© 2
,
©©2 3
table
™™ 
:
™™ 
$str
™™ )
,
™™) *
column
´´ 
:
´´ 
$str
´´  
)
´´  !
;
´´! "
migrationBuilder
≠≠ 
.
≠≠ 
CreateIndex
≠≠ (
(
≠≠( )
name
ÆÆ 
:
ÆÆ 
$str
ÆÆ 2
,
ÆÆ2 3
table
ØØ 
:
ØØ 
$str
ØØ )
,
ØØ) *
column
∞∞ 
:
∞∞ 
$str
∞∞  
)
∞∞  !
;
∞∞! "
migrationBuilder
≤≤ 
.
≤≤ 
CreateIndex
≤≤ (
(
≤≤( )
name
≥≥ 
:
≥≥ 
$str
≥≥ 1
,
≥≥1 2
table
¥¥ 
:
¥¥ 
$str
¥¥ (
,
¥¥( )
column
µµ 
:
µµ 
$str
µµ  
)
µµ  !
;
µµ! "
migrationBuilder
∑∑ 
.
∑∑ 
CreateIndex
∑∑ (
(
∑∑( )
name
∏∏ 
:
∏∏ 
$str
∏∏ "
,
∏∏" #
table
ππ 
:
ππ 
$str
ππ $
,
ππ$ %
column
∫∫ 
:
∫∫ 
$str
∫∫ )
)
∫∫) *
;
∫∫* +
migrationBuilder
ºº 
.
ºº 
CreateIndex
ºº (
(
ºº( )
name
ΩΩ 
:
ΩΩ 
$str
ΩΩ %
,
ΩΩ% &
table
ææ 
:
ææ 
$str
ææ $
,
ææ$ %
column
øø 
:
øø 
$str
øø ,
,
øø, -
unique
¿¿ 
:
¿¿ 
true
¿¿ 
,
¿¿ 
filter
¡¡ 
:
¡¡ 
$str
¡¡ :
)
¡¡: ;
;
¡¡; <
}
¬¬ 	
	protected
ƒƒ 
override
ƒƒ 
void
ƒƒ 
Down
ƒƒ  $
(
ƒƒ$ %
MigrationBuilder
ƒƒ% 5
migrationBuilder
ƒƒ6 F
)
ƒƒF G
{
≈≈ 	
migrationBuilder
∆∆ 
.
∆∆ 
	DropTable
∆∆ &
(
∆∆& '
name
«« 
:
«« 
$str
«« (
)
««( )
;
««) *
migrationBuilder
…… 
.
…… 
	DropTable
…… &
(
……& '
name
   
:
   
$str
   (
)
  ( )
;
  ) *
migrationBuilder
ÃÃ 
.
ÃÃ 
	DropTable
ÃÃ &
(
ÃÃ& '
name
ÕÕ 
:
ÕÕ 
$str
ÕÕ (
)
ÕÕ( )
;
ÕÕ) *
migrationBuilder
œœ 
.
œœ 
	DropTable
œœ &
(
œœ& '
name
–– 
:
–– 
$str
–– '
)
––' (
;
––( )
migrationBuilder
““ 
.
““ 
	DropTable
““ &
(
““& '
name
”” 
:
”” 
$str
”” (
)
””( )
;
””) *
migrationBuilder
’’ 
.
’’ 
	DropTable
’’ &
(
’’& '
name
÷÷ 
:
÷÷ 
$str
÷÷ #
)
÷÷# $
;
÷÷$ %
migrationBuilder
ÿÿ 
.
ÿÿ 
	DropTable
ÿÿ &
(
ÿÿ& '
name
ŸŸ 
:
ŸŸ 
$str
ŸŸ #
)
ŸŸ# $
;
ŸŸ$ %
}
⁄⁄ 	
}
€€ 
}‹‹ ⁄	
NC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\ApplicationDbContext.cs
	namespace 	
waterprj
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
IdentityDbContext( 9
{ 
public		  
ApplicationDbContext		 #
(		# $
DbContextOptions		$ 4
<		4 5 
ApplicationDbContext		5 I
>		I J
options		K R
)		R S
:

 
base

 
(

 
options

 
)

 
{ 	
} 	
public 
DbSet 
< 
waterprj 
. 
Models $
.$ %
Consumption% 0
>0 1
?1 2
Consumption3 >
{? @
getA D
;D E
setF I
;I J
}K L
public 
DbSet 
< 
waterprj 
. 
Models $
.$ %

Estimation% /
>/ 0
?0 1

Estimation2 <
{= >
get? B
;B C
setD G
;G H
}I J
} 
} Ë
OC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\HomeController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
}   Òú
UC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\EstimationController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class  
EstimationController %
:& '

Controller( 2
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public  
EstimationController #
(# $ 
ApplicationDbContext$ 8
context9 @
,A B 
IHttpContextAccessorC W
httpContextAccessorX k
)k l
{ 	
_context 
= 
context 
;  
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
} 	
public
 
async 
Task 
< 
IActionResult )
>) *
Index+ 0
(0 1
)1 2
{   
if!! 
(!! 
TempData!! 
[!! 
$str!! *
]!!* +
!=!!, .
null!!/ 3
)!!3 4
{"" 
ViewBag## 
.## 
SuccessMessage## 
=##  
TempData##! )
[##) *
$str##* :
]##: ;
;##; <
}$$ 
return%% 
_context%%  
.%%  !

Estimation%%! +
!=%%, .
null%%/ 3
?%%4 5
View&& !
(&&! "
await&&" '
_context&&( 0
.&&0 1

Estimation&&1 ;
.&&; <
ToListAsync&&< G
(&&G H
)&&H I
)&&I J
:&&K L
Problem'' $
(''$ %
$str''% ]
)''] ^
;''^ _
}(( 
[,, 	
HttpPost,,	 
],, 
[-- 	$
ValidateAntiForgeryToken--	 !
]--! "
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' (&
CalculateAndSaveEstimation..) C
(..C D
[..D E
Bind..E I
(..I J
$str	..J ü
)
..ü †
]
..† °

Estimation
..¢ ¨

estimation
..≠ ∑
)
..∑ ∏
{// 	
if00 
(00 

ModelState00 
.00 
IsValid00 "
)00" #
{11 

estimation44 
.44 
Date44 
=44  !
DateTime44" *
.44* +
Now44+ .
;44. /
double77 
estimatedVolume77 &
=77' (
CalculateEstimation77) <
(77< =

estimation77= G
)77G H
;77H I

estimation:: 
.:: 
EstimatedVolume:: *
=::+ ,
estimatedVolume::- <
;::< =
_context== 
.== 

Estimation== #
.==# $
Add==$ '
(==' (

estimation==( 2
)==2 3
;==3 4
await>> 
_context>> 
.>> 
SaveChangesAsync>> /
(>>/ 0
)>>0 1
;>>1 2
TempDataAA 
[AA 
$strAA +
]AA+ ,
=AA- .
estimatedVolumeAA/ >
.AA> ?
ToStringAA? G
(AAG H
)AAH I
;AAI J
returnDD 
RedirectToActionDD '
(DD' (
nameofDD( .
(DD. /
IndexDD/ 4
)DD4 5
)DD5 6
;DD6 7
}EE 
returnHH 
ViewHH 
(HH 
$strHH  
,HH  !

estimationHH! +
)HH+ ,
;HH, -
}II 	
privateQQ 
doubleQQ 
CalculateEstimationQQ *
(QQ* +

EstimationQQ+ 5

estimationQQ6 @
)QQ@ A
{RR 	
doubleUU 

baseVolumeUU 
=UU 
$numUU  #
;UU# $
doubleVV 

poolFactorVV 
=VV 

estimationVV  *
.VV* +
HasPoolVV+ 2
?VV3 4
$numVV5 7
:VV8 9
$numVV: ;
;VV; <
doubleWW 
dishwasherFactorWW #
=WW$ %

estimationWW& 0
.WW0 1
UsesDishwasherWW1 ?
?WW@ A
$numWWB D
:WWE F
$numWWG H
;WWH I
doubleYY 
totalVolumeYY 
=YY  

baseVolumeYY! +
+YY, -
(YY. /

estimationYY/ 9
.YY9 :
NumberOfPeopleYY: H
*YYI J
$numYYK M
)YYM N
+YYO P

poolFactorYYQ [
+YY\ ]
dishwasherFactorYY^ n
;YYn o
returnZZ 
totalVolumeZZ 
;ZZ 
}[[ 	
public^^ 
async^^ 
Task^^ 
<^^ 
IActionResult^^ '
>^^' (
Details^^) 0
(^^0 1
int^^1 4
?^^4 5
id^^6 8
)^^8 9
{__ 	
if`` 
(`` 
id`` 
==`` 
null`` 
||`` 
_context`` &
.``& '

Estimation``' 1
==``2 4
null``5 9
)``9 :
{aa 
returnbb 
NotFoundbb 
(bb  
)bb  !
;bb! "
}cc 
varee 

estimationee 
=ee 
awaitee "
_contextee# +
.ee+ ,

Estimationee, 6
.ff 
FirstOrDefaultAsyncff $
(ff$ %
mff% &
=>ff' )
mff* +
.ff+ ,
Idff, .
==ff/ 1
idff2 4
)ff4 5
;ff5 6
ifgg 
(gg 

estimationgg 
==gg 
nullgg "
)gg" #
{hh 
returnii 
NotFoundii 
(ii  
)ii  !
;ii! "
}jj 
returnll 
Viewll 
(ll 

estimationll "
)ll" #
;ll# $
}mm 	
publicpp 
IActionResultpp 
Createpp #
(pp# $
)pp$ %
{qq 	
returnrr 
Viewrr 
(rr 
)rr 
;rr 
}ss 	
[xx 	
HttpPostxx	 
]xx 
[yy 	$
ValidateAntiForgeryTokenyy	 !
]yy! "
publiczz 
asynczz 
Taskzz 
<zz 
IActionResultzz '
>zz' (
Createzz) /
(zz/ 0
[zz0 1
Bindzz1 5
(zz5 6
$str	zz6 ß
)
zzß ®
]
zz® ©

Estimation
zz™ ¥

estimation
zzµ ø
)
zzø ¿
{{{ 	
if|| 
(|| 

ModelState|| 
.|| 
IsValid|| "
)||" #
{}} 
if~~ 
(~~ 

estimation~~ 
.~~ 
EstimatedVolume~~ .
==~~/ 1
null~~2 6
)~~6 7
{ 
double
ÄÄ 
estimatedVolume
ÄÄ *
=
ÄÄ+ ,!
CalculateEstimation
ÄÄ- @
(
ÄÄ@ A

estimation
ÄÄA K
)
ÄÄK L
;
ÄÄL M

estimation
ÅÅ 
.
ÅÅ 
EstimatedVolume
ÅÅ .
=
ÅÅ/ 0
estimatedVolume
ÅÅ1 @
;
ÅÅ@ A
}
ÇÇ 
_context
ÑÑ 
.
ÑÑ 
Add
ÑÑ 
(
ÑÑ 

estimation
ÑÑ '
)
ÑÑ' (
;
ÑÑ( )
await
ÖÖ 
_context
ÖÖ 
.
ÖÖ 
SaveChangesAsync
ÖÖ /
(
ÖÖ/ 0
)
ÖÖ0 1
;
ÖÖ1 2
TempData
ÜÜ 
[
ÜÜ 
$str
ÜÜ )
]
ÜÜ) *
=
ÜÜ+ ,
$str
ÜÜ- b
+
ÜÜc d

estimation
ÜÜe o
.
ÜÜo p
EstimatedVolume
ÜÜp 
+ÜÜÄ Å
$strÜÜÇ ã
;ÜÜã å
return
àà 
RedirectToAction
àà '
(
àà' (
nameof
àà( .
(
àà. /
Index
àà/ 4
)
àà4 5
)
àà5 6
;
àà6 7
}
ää 
return
çç 
View
çç 
(
çç 

estimation
çç "
)
çç" #
;
çç# $
}
éé 	
public
ëë 
async
ëë 
Task
ëë 
<
ëë 
IActionResult
ëë '
>
ëë' (
Edit
ëë) -
(
ëë- .
int
ëë. 1
?
ëë1 2
id
ëë3 5
)
ëë5 6
{
íí 	
if
ìì 
(
ìì 
id
ìì 
==
ìì 
null
ìì 
||
ìì 
_context
ìì &
.
ìì& '

Estimation
ìì' 1
==
ìì2 4
null
ìì5 9
)
ìì9 :
{
îî 
return
ïï 
NotFound
ïï 
(
ïï  
)
ïï  !
;
ïï! "
}
ññ 
var
òò 

estimation
òò 
=
òò 
await
òò "
_context
òò# +
.
òò+ ,

Estimation
òò, 6
.
òò6 7
	FindAsync
òò7 @
(
òò@ A
id
òòA C
)
òòC D
;
òòD E
if
ôô 
(
ôô 

estimation
ôô 
==
ôô 
null
ôô "
)
ôô" #
{
öö 
return
õõ 
NotFound
õõ 
(
õõ  
)
õõ  !
;
õõ! "
}
úú 
return
ùù 
View
ùù 
(
ùù 

estimation
ùù "
)
ùù" #
;
ùù# $
}
ûû 	
[
££ 	
HttpPost
££	 
]
££ 
[
§§ 	&
ValidateAntiForgeryToken
§§	 !
]
§§! "
public
•• 
async
•• 
Task
•• 
<
•• 
IActionResult
•• '
>
••' (
Edit
••) -
(
••- .
int
••. 1
id
••2 4
,
••4 5
[
••6 7
Bind
••7 ;
(
••; <
$str••< ∞
)••∞ ±
]••± ≤

Estimation••≥ Ω

estimation••æ »
)••» …
{
¶¶ 	
if
ßß 
(
ßß 
id
ßß 
!=
ßß 

estimation
ßß  
.
ßß  !
Id
ßß! #
)
ßß# $
{
®® 
return
©© 
NotFound
©© 
(
©©  
)
©©  !
;
©©! "
}
™™ 
if
¨¨ 
(
¨¨ 

ModelState
¨¨ 
.
¨¨ 
IsValid
¨¨ "
)
¨¨" #
{
≠≠ 
try
ÆÆ 
{
ØØ 
var
±±  
originalEstimation
±± *
=
±±+ ,
await
±±- 2
_context
±±3 ;
.
±±; <

Estimation
±±< F
.
±±F G
AsNoTracking
±±G S
(
±±S T
)
±±T U
.
±±U V!
FirstOrDefaultAsync
±±V i
(
±±i j
e
±±j k
=>
±±l n
e
±±o p
.
±±p q
Id
±±q s
==
±±t v

estimation±±w Å
.±±Å Ç
Id±±Ç Ñ
)±±Ñ Ö
;±±Ö Ü
if
≥≥ 
(
≥≥  
originalEstimation
≥≥ *
==
≥≥+ -
null
≥≥. 2
)
≥≥2 3
{
¥¥ 
return
µµ 
NotFound
µµ '
(
µµ' (
)
µµ( )
;
µµ) *
}
∂∂ 
if
ππ 
(
ππ 

estimation
ππ "
.
ππ" #
EstimatedVolume
ππ# 2
==
ππ3 5
null
ππ6 :
)
ππ: ;
{
∫∫ 
double
ªª  
newEstimatedVolume
ªª 1
=
ªª2 3!
CalculateEstimation
ªª4 G
(
ªªG H

estimation
ªªH R
)
ªªR S
;
ªªS T

estimation
ºº "
.
ºº" #
EstimatedVolume
ºº# 2
=
ºº3 4 
newEstimatedVolume
ºº5 G
;
ººG H
}
ΩΩ 
if
¿¿ 
(
¿¿ (
EstimationValuesAreChanged
¿¿ 2
(
¿¿2 3

estimation
¿¿3 =
,
¿¿= > 
originalEstimation
¿¿? Q
)
¿¿Q R
)
¿¿R S
{
¡¡ 
double
√√  
newEstimatedVolume
√√ 1
=
√√2 3!
CalculateEstimation
√√4 G
(
√√G H

estimation
√√H R
)
√√R S
;
√√S T

estimation
ƒƒ "
.
ƒƒ" #
EstimatedVolume
ƒƒ# 2
=
ƒƒ3 4 
newEstimatedVolume
ƒƒ5 G
;
ƒƒG H
}
≈≈ 
_context
…… 
.
…… 
Update
…… #
(
……# $

estimation
……$ .
)
……. /
;
……/ 0
await
   
_context
   "
.
  " #
SaveChangesAsync
  # 3
(
  3 4
)
  4 5
;
  5 6
TempData
ÕÕ 
[
ÕÕ 
$str
ÕÕ *
]
ÕÕ* +
=
ÕÕ, -
$str
ÕÕ. c
+
ÕÕd e

estimation
ÕÕf p
.
ÕÕp q
EstimatedVolumeÕÕq Ä
+ÕÕÄ Å
$strÕÕÅ ã
;ÕÕã å
}
ŒŒ 
catch
œœ 
(
œœ *
DbUpdateConcurrencyException
œœ 3
)
œœ3 4
{
–– 
if
—— 
(
—— 
!
—— 
EstimationExists
—— )
(
——) *

estimation
——* 4
.
——4 5
Id
——5 7
)
——7 8
)
——8 9
{
““ 
return
”” 
NotFound
”” '
(
””' (
)
””( )
;
””) *
}
‘‘ 
else
’’ 
{
÷÷ 
throw
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 
return
⁄⁄ 
RedirectToAction
⁄⁄ '
(
⁄⁄' (
nameof
⁄⁄( .
(
⁄⁄. /
Index
⁄⁄/ 4
)
⁄⁄4 5
)
⁄⁄5 6
;
⁄⁄6 7
}
€€ 
return
‹‹ 
View
‹‹ 
(
‹‹ 

estimation
‹‹ "
)
‹‹" #
;
‹‹# $
}
›› 	
private
‡‡ 
bool
‡‡ (
EstimationValuesAreChanged
‡‡ /
(
‡‡/ 0

Estimation
‡‡0 :
currentEstimation
‡‡; L
,
‡‡L M

Estimation
‡‡N X 
originalEstimation
‡‡Y k
)
‡‡k l
{
·· 	
return
„„ 
currentEstimation
„„ $
.
„„$ %
NumberOfPeople
„„% 3
!=
„„4 6 
originalEstimation
„„7 I
.
„„I J
NumberOfPeople
„„J X
||
„„Y [
currentEstimation
‰‰ $
.
‰‰$ %
HasPool
‰‰% ,
!=
‰‰- / 
originalEstimation
‰‰0 B
.
‰‰B C
HasPool
‰‰C J
||
‰‰K M
currentEstimation
ÂÂ $
.
ÂÂ$ %
UsesDishwasher
ÂÂ% 3
!=
ÂÂ4 6 
originalEstimation
ÂÂ7 I
.
ÂÂI J
UsesDishwasher
ÂÂJ X
||
ÂÂY [
currentEstimation
ÊÊ $
.
ÊÊ$ %
LaundryFrequency
ÊÊ% 5
!=
ÊÊ6 8 
originalEstimation
ÊÊ9 K
.
ÊÊK L
LaundryFrequency
ÊÊL \
||
ÊÊ] _
currentEstimation
ÁÁ $
.
ÁÁ$ %
ShowerDuration
ÁÁ% 3
!=
ÁÁ4 6 
originalEstimation
ÁÁ7 I
.
ÁÁI J
ShowerDuration
ÁÁJ X
||
ÁÁY [
currentEstimation
ËË $
.
ËË$ %
LeakDetection
ËË% 2
!=
ËË3 5 
originalEstimation
ËË6 H
.
ËËH I
LeakDetection
ËËI V
;
ËËV W
}
ÈÈ 	
public
ÏÏ 
async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
IActionResult
ÏÏ '
>
ÏÏ' (
Delete
ÏÏ) /
(
ÏÏ/ 0
int
ÏÏ0 3
?
ÏÏ3 4
id
ÏÏ5 7
)
ÏÏ7 8
{
ÌÌ 	
if
ÓÓ 
(
ÓÓ 
id
ÓÓ 
==
ÓÓ 
null
ÓÓ 
||
ÓÓ 
_context
ÓÓ &
.
ÓÓ& '

Estimation
ÓÓ' 1
==
ÓÓ2 4
null
ÓÓ5 9
)
ÓÓ9 :
{
ÔÔ 
return
 
NotFound
 
(
  
)
  !
;
! "
}
ÒÒ 
var
ÛÛ 

estimation
ÛÛ 
=
ÛÛ 
await
ÛÛ "
_context
ÛÛ# +
.
ÛÛ+ ,

Estimation
ÛÛ, 6
.
ÙÙ !
FirstOrDefaultAsync
ÙÙ $
(
ÙÙ$ %
m
ÙÙ% &
=>
ÙÙ' )
m
ÙÙ* +
.
ÙÙ+ ,
Id
ÙÙ, .
==
ÙÙ/ 1
id
ÙÙ2 4
)
ÙÙ4 5
;
ÙÙ5 6
if
ıı 
(
ıı 

estimation
ıı 
==
ıı 
null
ıı "
)
ıı" #
{
ˆˆ 
return
˜˜ 
NotFound
˜˜ 
(
˜˜  
)
˜˜  !
;
˜˜! "
}
¯¯ 
return
˙˙ 
View
˙˙ 
(
˙˙ 

estimation
˙˙ "
)
˙˙" #
;
˙˙# $
}
˚˚ 	
[
˛˛ 	
HttpPost
˛˛	 
,
˛˛ 

ActionName
˛˛ 
(
˛˛ 
$str
˛˛ &
)
˛˛& '
]
˛˛' (
[
ˇˇ 	&
ValidateAntiForgeryToken
ˇˇ	 !
]
ˇˇ! "
public
ÄÄ 
async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
IActionResult
ÄÄ '
>
ÄÄ' (
DeleteConfirmed
ÄÄ) 8
(
ÄÄ8 9
int
ÄÄ9 <
id
ÄÄ= ?
)
ÄÄ? @
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 
_context
ÇÇ 
.
ÇÇ 

Estimation
ÇÇ #
==
ÇÇ$ &
null
ÇÇ' +
)
ÇÇ+ ,
{
ÉÉ 
return
ÑÑ 
Problem
ÑÑ 
(
ÑÑ 
$str
ÑÑ W
)
ÑÑW X
;
ÑÑX Y
}
ÖÖ 
var
ÜÜ 

estimation
ÜÜ 
=
ÜÜ 
await
ÜÜ "
_context
ÜÜ# +
.
ÜÜ+ ,

Estimation
ÜÜ, 6
.
ÜÜ6 7
	FindAsync
ÜÜ7 @
(
ÜÜ@ A
id
ÜÜA C
)
ÜÜC D
;
ÜÜD E
if
áá 
(
áá 

estimation
áá 
!=
áá 
null
áá "
)
áá" #
{
àà 
_context
ââ 
.
ââ 

Estimation
ââ #
.
ââ# $
Remove
ââ$ *
(
ââ* +

estimation
ââ+ 5
)
ââ5 6
;
ââ6 7
}
ää 
await
åå 
_context
åå 
.
åå 
SaveChangesAsync
åå +
(
åå+ ,
)
åå, -
;
åå- .
return
éé 
RedirectToAction
éé #
(
éé# $
nameof
éé$ *
(
éé* +'
ResetAutoIncrementIfEmpty
éé+ D
)
ééD E
)
ééE F
;
ééF G
return
èè 
RedirectToAction
èè #
(
èè# $
nameof
èè$ *
(
èè* +
Index
èè+ 0
)
èè0 1
)
èè1 2
;
èè2 3
}
ëë 	
private
ìì 
bool
ìì 
EstimationExists
ìì %
(
ìì% &
int
ìì& )
id
ìì* ,
)
ìì, -
{
îî 	
return
ïï
 
(
ïï 
_context
ïï 
.
ïï 

Estimation
ïï %
?
ïï% &
.
ïï& '
Any
ïï' *
(
ïï* +
e
ïï+ ,
=>
ïï- /
e
ïï0 1
.
ïï1 2
Id
ïï2 4
==
ïï5 7
id
ïï8 :
)
ïï: ;
)
ïï; <
.
ïï< =
GetValueOrDefault
ïï= N
(
ïïN O
)
ïïO P
;
ïïP Q
}
ññ 	
public
òò
 
IActionResult
òò '
ResetAutoIncrementIfEmpty
òò 8
(
òò8 9
)
òò9 :
{
ôô 	
if
õõ 
(
õõ 
!
õõ 
_context
õõ 
.
õõ 

Estimation
õõ $
.
õõ$ %
Any
õõ% (
(
õõ( )
)
õõ) *
)
õõ* +
{
úú 
_context
ûû 
.
ûû 
Database
ûû !
.
ûû! "
ExecuteSqlRaw
ûû" /
(
ûû/ 0
$str
ûû0 [
)
ûû[ \
;
ûû\ ]
}
üü 
return
°° 
RedirectToAction
°° #
(
°°# $
nameof
°°$ *
(
°°* +
Index
°°+ 0
)
°°0 1
)
°°1 2
;
°°2 3
}
¢¢ 	
}
££ 
}§§ Û°
VC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\ConsumptionController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class !
ConsumptionController &
:' (

Controller) 3
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
_userManager3 ?
;? @
public !
ConsumptionController $
($ %
UserManager% 0
<0 1
IdentityUser1 =
>= >
userManager? J
,J K 
ApplicationDbContextL `
contexta h
)h i
{ 	
_userManager 
= 
userManager &
;& '
_context   
=   
context   
;   
}!! 	
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Index))) .
()). /
)))/ 0
{++ 	
string// 
userId// 
=// 
_userManager// (
.//( )
	GetUserId//) 2
(//2 3
User//3 7
)//7 8
;//8 9
var22 
userConsumptions22  
=22! "
await22# (
_context22) 1
.221 2
Consumption222 =
.33 
Where33 
(33 
c33 
=>33 
c33 
.33 
UserId33 $
==33% '
userId33( .
)33. /
.44 
ToListAsync44 
(44 
)44 
;44 
var77 
userMonthlyData77 
=77  !
userConsumptions77" 2
.88	 

Where88
 
(88 
c88 
=>88 
c88 
.88 
UserId88 
==88  
userId88! '
)88' (
.99	 

GroupBy99
 
(99 
c99 
=>99 
new99 
{99 
Year99 !
=99" #
c99$ %
.99% &
Date99& *
.99* +
Year99+ /
,99/ 0
Month991 6
=997 8
c999 :
.99: ;
Date99; ?
.99? @
Month99@ E
}99F G
)99G H
.::	 


SelectMany::
 
(:: 
g:: 
=>:: 
g:: 
.:: 
Select:: "
(::" #
c::# $
=>::% '
new::( +
{::, -
Month::. 3
=::4 5
$"::6 8
{::8 9
g::9 :
.::: ;
Key::; >
.::> ?
Month::? D
}::D E
$str::E F
{::F G
g::G H
.::H I
Key::I L
.::L M
Year::M Q
}::Q R
"::R S
,::S T
Volume::U [
=::\ ]
c::^ _
.::_ `
Volume::` f
}::g h
)::h i
)::i j
.;;	 

OrderBy;;
 
(;; 
g;; 
=>;; 
g;; 
.;; 
Month;; 
);; 
.<<	 

ToList<<
 
(<< 
)<< 
;<< 
varCC 
userMonthlyDatabarCC "
=CC# $
userConsumptionsCC% 5
.DD 	
WhereDD	 
(DD 
cDD 
=>DD 
cDD 
.DD 
UserIdDD 
==DD 
userIdDD  &
)DD& '
.EE 	
GroupByEE	 
(EE 
cEE 
=>EE 
newEE 
{EE 
YearEE  
=EE! "
cEE# $
.EE$ %
DateEE% )
.EE) *
YearEE* .
,EE. /
MonthEE0 5
=EE6 7
cEE8 9
.EE9 :
DateEE: >
.EE> ?
MonthEE? D
}EEE F
)EEF G
.FF 	
SelectFF	 
(FF 
gFF 
=>FF 
newFF 
{GG 	
MonthHH 
=HH 
$"HH 
{HH 
gHH 
.HH 
KeyHH 
.HH 
MonthHH "
}HH" #
$strHH# $
{HH$ %
gHH% &
.HH& '
KeyHH' *
.HH* +
YearHH+ /
}HH/ 0
"HH0 1
,HH1 2
VolumeII 
=II 
gII 
.II 
SumII 
(II 
cII 
=>II 
cII  !
.II! "
VolumeII" (
)II( )
}JJ 	
)JJ	 

.KK 	
OrderByKK	 
(KK 
gKK 
=>KK 
gKK 
.KK 
MonthKK 
)KK 
.LL 	
ToListLL	 
(LL 
)LL 
;LL 
varOO !
generalMonthlyAverageOO %
=OO& '
awaitOO( -
_contextOO. 6
.OO6 7
ConsumptionOO7 B
.PP 
GroupByPP 
(PP 
cPP 
=>PP 
newPP !
{PP" #
cPP$ %
.PP% &
DatePP& *
.PP* +
YearPP+ /
,PP/ 0
cPP1 2
.PP2 3
DatePP3 7
.PP7 8
MonthPP8 =
}PP> ?
)PP? @
.QQ 
SelectQQ 
(QQ 
gQQ 
=>QQ 
newQQ  
{RR 
MonthSS 
=SS 
newSS 
DateTimeSS  (
(SS( )
gSS) *
.SS* +
KeySS+ .
.SS. /
YearSS/ 3
,SS3 4
gSS5 6
.SS6 7
KeySS7 :
.SS: ;
MonthSS; @
,SS@ A
$numSSB C
)SSC D
,SSD E
AverageVolumeTT !
=TT" #
gTT$ %
.TT% &
AverageTT& -
(TT- .
cTT. /
=>TT0 2
cTT3 4
.TT4 5
VolumeTT5 ;
)TT; <
}UU 
)UU 
.VV 
ToDictionaryAsyncVV "
(VV" #
xVV# $
=>VV% '
xVV( )
.VV) *
MonthVV* /
.VV/ 0
ToStringVV0 8
(VV8 9
$strVV9 C
)VVC D
,VVD E
xVVF G
=>VVH J
MathVVK O
.VVO P
RoundVVP U
(VVU V
xVVV W
.VVW X
AverageVolumeVVX e
,VVe f
$numVVg h
)VVh i
)VVi j
;VVj k
ViewDataYY 
[YY 
$strYY &
]YY& '
=YY( )
userMonthlyDataYY* 9
;YY9 :
ViewDataZZ 
[ZZ 
$strZZ '
]ZZ' (
=ZZ) *!
generalMonthlyAverageZZ+ @
;ZZ@ A
ViewData[[ 
[[[ 
$str[[ )
][[) *
=[[+ ,
JsonConvert[[- 8
.[[8 9
SerializeObject[[9 H
([[H I
userMonthlyDatabar[[I [
)[[[ \
;[[\ ]
return]] 
View]] 
(]] 
userConsumptions]] (
)]]( )
;]]) *
}__ 
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
Detailshh) 0
(hh0 1
inthh1 4
?hh4 5
idhh6 8
)hh8 9
{ii 	
ifjj 
(jj 
idjj 
==jj 
nulljj 
||jj 
_contextjj &
.jj& '
Consumptionjj' 2
==jj3 5
nulljj6 :
)jj: ;
{kk 
returnll 
NotFoundll 
(ll  
)ll  !
;ll! "
}mm 
varoo 
consumptionoo 
=oo 
awaitoo #
_contextoo$ ,
.oo, -
Consumptionoo- 8
.pp 
FirstOrDefaultAsyncpp $
(pp$ %
mpp% &
=>pp' )
mpp* +
.pp+ ,
Idpp, .
==pp/ 1
idpp2 4
)pp4 5
;pp5 6
ifqq 
(qq 
consumptionqq 
==qq 
nullqq #
)qq# $
{rr 
returnss 
NotFoundss 
(ss  
)ss  !
;ss! "
}tt 
returnvv 
Viewvv 
(vv 
consumptionvv #
)vv# $
;vv$ %
}ww 	
publiczz 
IActionResultzz 
Createzz #
(zz# $
)zz$ %
{{{ 	
return|| 
View|| 
(|| 
)|| 
;|| 
}}} 	
[
ÇÇ 	
HttpPost
ÇÇ	 
]
ÇÇ 
[
ÉÉ 	&
ValidateAntiForgeryToken
ÉÉ	 !
]
ÉÉ! "
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
Create
ÑÑ) /
(
ÑÑ/ 0
[
ÑÑ0 1
Bind
ÑÑ1 5
(
ÑÑ5 6
$str
ÑÑ6 M
)
ÑÑM N
]
ÑÑN O
Consumption
ÑÑP [
consumption
ÑÑ\ g
)
ÑÑg h
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 

ModelState
ÜÜ 
.
ÜÜ 
IsValid
ÜÜ "
)
ÜÜ" #
{
áá 
string
ââ 
userId
ââ 
=
ââ 
User
ââ  $
.
ââ$ %
FindFirstValue
ââ% 3
(
ââ3 4

ClaimTypes
ââ4 >
.
ââ> ?
NameIdentifier
ââ? M
)
ââM N
;
ââN O
consumption
åå 
.
åå 
UserId
åå "
=
åå# $
userId
åå% +
;
åå+ ,
_context
êê 
.
êê 
Add
êê 
(
êê 
consumption
êê (
)
êê( )
;
êê) *
await
ëë 
_context
ëë 
.
ëë 
SaveChangesAsync
ëë /
(
ëë/ 0
)
ëë0 1
;
ëë1 2
return
íí 
RedirectToAction
íí '
(
íí' (
nameof
íí( .
(
íí. /
Index
íí/ 4
)
íí4 5
)
íí5 6
;
íí6 7
}
ìì 
foreach
ññ 
(
ññ 
var
ññ 

modelState
ññ #
in
ññ$ &

ModelState
ññ' 1
.
ññ1 2
Values
ññ2 8
)
ññ8 9
{
óó 
foreach
òò 
(
òò 
var
òò 
error
òò "
in
òò# %

modelState
òò& 0
.
òò0 1
Errors
òò1 7
)
òò7 8
{
ôô 
Console
õõ 
.
õõ 
	WriteLine
õõ %
(
õõ% &
error
õõ& +
.
õõ+ ,
ErrorMessage
õõ, 8
)
õõ8 9
;
õõ9 :
}
úú 
}
ùù 
return
ûû 
View
ûû 
(
ûû 
consumption
ûû #
)
ûû# $
;
ûû$ %
}
üü 	
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
IActionResult
¢¢ '
>
¢¢' (
Edit
¢¢) -
(
¢¢- .
int
¢¢. 1
?
¢¢1 2
id
¢¢3 5
)
¢¢5 6
{
££ 	
if
§§ 
(
§§ 
id
§§ 
==
§§ 
null
§§ 
||
§§ 
_context
§§ &
.
§§& '
Consumption
§§' 2
==
§§3 5
null
§§6 :
)
§§: ;
{
•• 
return
¶¶ 
NotFound
¶¶ 
(
¶¶  
)
¶¶  !
;
¶¶! "
}
ßß 
var
©© 
consumption
©© 
=
©© 
await
©© #
_context
©©$ ,
.
©©, -
Consumption
©©- 8
.
©©8 9
	FindAsync
©©9 B
(
©©B C
id
©©C E
)
©©E F
;
©©F G
if
™™ 
(
™™ 
consumption
™™ 
==
™™ 
null
™™ #
)
™™# $
{
´´ 
return
¨¨ 
NotFound
¨¨ 
(
¨¨  
)
¨¨  !
;
¨¨! "
}
≠≠ 
return
ÆÆ 
View
ÆÆ 
(
ÆÆ 
consumption
ÆÆ #
)
ÆÆ# $
;
ÆÆ$ %
}
ØØ 	
[
¥¥ 	
HttpPost
¥¥	 
]
¥¥ 
[
µµ 	&
ValidateAntiForgeryToken
µµ	 !
]
µµ! "
public
∂∂ 
async
∂∂ 
Task
∂∂ 
<
∂∂ 
IActionResult
∂∂ '
>
∂∂' (
Edit
∂∂) -
(
∂∂- .
int
∂∂. 1
id
∂∂2 4
,
∂∂4 5
[
∂∂6 7
Bind
∂∂7 ;
(
∂∂; <
$str
∂∂< S
)
∂∂S T
]
∂∂T U
Consumption
∂∂V a
consumption
∂∂b m
)
∂∂m n
{
∑∑ 	
if
∏∏ 
(
∏∏ 
id
∏∏ 
!=
∏∏ 
consumption
∏∏ !
.
∏∏! "
Id
∏∏" $
)
∏∏$ %
{
ππ 
return
∫∫ 
NotFound
∫∫ 
(
∫∫  
)
∫∫  !
;
∫∫! "
}
ªª 
if
ΩΩ 
(
ΩΩ 

ModelState
ΩΩ 
.
ΩΩ 
IsValid
ΩΩ "
)
ΩΩ" #
{
ææ 
try
øø 
{
¿¿ 
_context
¡¡ 
.
¡¡ 
Update
¡¡ #
(
¡¡# $
consumption
¡¡$ /
)
¡¡/ 0
;
¡¡0 1
await
¬¬ 
_context
¬¬ "
.
¬¬" #
SaveChangesAsync
¬¬# 3
(
¬¬3 4
)
¬¬4 5
;
¬¬5 6
}
√√ 
catch
ƒƒ 
(
ƒƒ *
DbUpdateConcurrencyException
ƒƒ 3
)
ƒƒ3 4
{
≈≈ 
if
∆∆ 
(
∆∆ 
!
∆∆ 
ConsumptionExists
∆∆ *
(
∆∆* +
consumption
∆∆+ 6
.
∆∆6 7
Id
∆∆7 9
)
∆∆9 :
)
∆∆: ;
{
«« 
return
»» 
NotFound
»» '
(
»»' (
)
»»( )
;
»») *
}
…… 
else
   
{
ÀÀ 
throw
ÃÃ 
;
ÃÃ 
}
ÕÕ 
}
ŒŒ 
return
œœ 
RedirectToAction
œœ '
(
œœ' (
nameof
œœ( .
(
œœ. /
Index
œœ/ 4
)
œœ4 5
)
œœ5 6
;
œœ6 7
}
–– 
return
—— 
View
—— 
(
—— 
consumption
—— #
)
——# $
;
——$ %
}
““ 	
public
’’ 
async
’’ 
Task
’’ 
<
’’ 
IActionResult
’’ '
>
’’' (
Delete
’’) /
(
’’/ 0
int
’’0 3
?
’’3 4
id
’’5 7
)
’’7 8
{
÷÷ 	
if
◊◊ 
(
◊◊ 
id
◊◊ 
==
◊◊ 
null
◊◊ 
||
◊◊ 
_context
◊◊ &
.
◊◊& '
Consumption
◊◊' 2
==
◊◊3 5
null
◊◊6 :
)
◊◊: ;
{
ÿÿ 
return
ŸŸ 
NotFound
ŸŸ 
(
ŸŸ  
)
ŸŸ  !
;
ŸŸ! "
}
⁄⁄ 
var
‹‹ 
consumption
‹‹ 
=
‹‹ 
await
‹‹ #
_context
‹‹$ ,
.
‹‹, -
Consumption
‹‹- 8
.
›› !
FirstOrDefaultAsync
›› $
(
››$ %
m
››% &
=>
››' )
m
››* +
.
››+ ,
Id
››, .
==
››/ 1
id
››2 4
)
››4 5
;
››5 6
if
ﬁﬁ 
(
ﬁﬁ 
consumption
ﬁﬁ 
==
ﬁﬁ 
null
ﬁﬁ #
)
ﬁﬁ# $
{
ﬂﬂ 
return
‡‡ 
NotFound
‡‡ 
(
‡‡  
)
‡‡  !
;
‡‡! "
}
·· 
return
„„ 
View
„„ 
(
„„ 
consumption
„„ #
)
„„# $
;
„„$ %
}
‰‰ 	
[
ÁÁ 	
HttpPost
ÁÁ	 
,
ÁÁ 

ActionName
ÁÁ 
(
ÁÁ 
$str
ÁÁ &
)
ÁÁ& '
]
ÁÁ' (
[
ËË 	&
ValidateAntiForgeryToken
ËË	 !
]
ËË! "
public
ÈÈ 
async
ÈÈ 
Task
ÈÈ 
<
ÈÈ 
IActionResult
ÈÈ '
>
ÈÈ' (
DeleteConfirmed
ÈÈ) 8
(
ÈÈ8 9
int
ÈÈ9 <
id
ÈÈ= ?
)
ÈÈ? @
{
ÍÍ 	
if
ÎÎ 
(
ÎÎ 
_context
ÎÎ 
.
ÎÎ 
Consumption
ÎÎ $
==
ÎÎ% '
null
ÎÎ( ,
)
ÎÎ, -
{
ÏÏ 
return
ÌÌ 
Problem
ÌÌ 
(
ÌÌ 
$str
ÌÌ X
)
ÌÌX Y
;
ÌÌY Z
}
ÓÓ 
var
ÔÔ 
consumption
ÔÔ 
=
ÔÔ 
await
ÔÔ #
_context
ÔÔ$ ,
.
ÔÔ, -
Consumption
ÔÔ- 8
.
ÔÔ8 9
	FindAsync
ÔÔ9 B
(
ÔÔB C
id
ÔÔC E
)
ÔÔE F
;
ÔÔF G
if
 
(
 
consumption
 
!=
 
null
 #
)
# $
{
ÒÒ 
_context
ÚÚ 
.
ÚÚ 
Consumption
ÚÚ $
.
ÚÚ$ %
Remove
ÚÚ% +
(
ÚÚ+ ,
consumption
ÚÚ, 7
)
ÚÚ7 8
;
ÚÚ8 9
}
ÛÛ 
await
ıı 
_context
ıı 
.
ıı 
SaveChangesAsync
ıı +
(
ıı+ ,
)
ıı, -
;
ıı- .
return
ˆˆ 
RedirectToAction
ˆˆ #
(
ˆˆ# $
nameof
ˆˆ$ *
(
ˆˆ* +
Index
ˆˆ+ 0
)
ˆˆ0 1
)
ˆˆ1 2
;
ˆˆ2 3
}
˜˜ 	
private
˘˘ 
bool
˘˘ 
ConsumptionExists
˘˘ &
(
˘˘& '
int
˘˘' *
id
˘˘+ -
)
˘˘- .
{
˙˙ 	
return
˚˚ 
(
˚˚ 
_context
˚˚ 
.
˚˚ 
Consumption
˚˚ (
?
˚˚( )
.
˚˚) *
Any
˚˚* -
(
˚˚- .
e
˚˚. /
=>
˚˚0 2
e
˚˚3 4
.
˚˚4 5
Id
˚˚5 7
==
˚˚8 :
id
˚˚; =
)
˚˚= >
)
˚˚> ?
.
˚˚? @
GetValueOrDefault
˚˚@ Q
(
˚˚Q R
)
˚˚R S
;
˚˚S T
}
¸¸ 	
public
ÄÄ 
IActionResult
ÄÄ 
Advice
ÄÄ #
(
ÄÄ# $
)
ÄÄ$ %
{
ÅÅ 	
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
àà 
async
àà 
Task
àà 
<
àà 
IActionResult
àà '
>
àà' (%
MonthlyConsumptionChart
àà) @
(
àà@ A
)
ààA B
{
ââ 	
var
ää 
userId
ää 
=
ää 
_userManager
ää %
.
ää% &
	GetUserId
ää& /
(
ää/ 0
User
ää0 4
)
ää4 5
;
ää5 6
var
ãã 
userMonthlyData
ãã 
=
ãã  !
_context
ãã" *
.
ãã* +
Consumption
ãã+ 6
.
åå 
Where
åå 
(
åå 
c
åå 
=>
åå 
c
åå 
.
åå 
UserId
åå $
==
åå% '
userId
åå( .
)
åå. /
.
çç 
GroupBy
çç 
(
çç 
c
çç 
=>
çç 
new
çç !
{
çç" #
c
çç$ %
.
çç% &
Date
çç& *
.
çç* +
Year
çç+ /
,
çç/ 0
c
çç1 2
.
çç2 3
Date
çç3 7
.
çç7 8
Month
çç8 =
}
çç> ?
)
çç? @
.
éé 
OrderBy
éé 
(
éé 
g
éé 
=>
éé 
g
éé 
.
éé  
Key
éé  #
.
éé# $
Year
éé$ (
)
éé( )
.
éé) *
ThenBy
éé* 0
(
éé0 1
g
éé1 2
=>
éé3 5
g
éé6 7
.
éé7 8
Key
éé8 ;
.
éé; <
Month
éé< A
)
ééA B
.
èè 
Select
èè 
(
èè 
g
èè 
=>
èè 
new
èè  
{
èè! "
Month
èè# (
=
èè) *
$"
èè+ -
{
èè- .
g
èè. /
.
èè/ 0
Key
èè0 3
.
èè3 4
Month
èè4 9
}
èè9 :
$str
èè: ;
{
èè; <
g
èè< =
.
èè= >
Key
èè> A
.
èèA B
Year
èèB F
}
èèF G
"
èèG H
,
èèH I
Volume
èèJ P
=
èèQ R
g
èèS T
.
èèT U
Sum
èèU X
(
èèX Y
c
èèY Z
=>
èè[ ]
c
èè^ _
.
èè_ `
Volume
èè` f
)
èèf g
}
èèh i
)
èèi j
;
èèj k
return
ëë 
Json
ëë 
(
ëë 
userMonthlyData
ëë '
)
ëë' (
;
ëë( )
}
íí 	
}
ïï 
}ññ 
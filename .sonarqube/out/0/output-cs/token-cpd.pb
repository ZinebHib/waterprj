£
JC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\ErrorViewModel.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 µ
FC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\Estimation.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 

Estimation 
{ 
[ 	
Key	 
] 
[		 	
DatabaseGenerated			 
(		 #
DatabaseGeneratedOption		 2
.		2 3
Identity		3 ;
)		; <
]		< =
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
double 
? 
EstimatedVolume &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[ 	
Required	 
( 
ErrorMessage 
=  
$str! E
)E F
]F G
public 
int 
NumberOfPeople !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
bool 
HasPool 
{ 
get !
;! "
set# &
;& '
}( )
public 
bool 
UsesDishwasher "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
Required	 
( 
ErrorMessage 
=  
$str! G
)G H
]H I
public 
int 
LaundryFrequency #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
Required	 
( 
ErrorMessage 
=  
$str! A
)A B
]B C
public 
int 
ShowerDuration !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
bool 
LeakDetection !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} ³6
<C:\Users\21260\OneDrive\Documents\dotnet\waterprj\Program.cs
	namespace 	
waterprj
 
{ 
public 

class 
Program 
{		 
public 
static 
async 
Task  
Main! %
(% &
string& ,
[, -
]- .
args/ 3
)3 4
{ 	
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
var 
connectionString  
=! "
builder# *
.* +
Configuration+ 8
.8 9
GetConnectionString9 L
(L M
$strM `
)` a
;a b
builder 
. 
Services 
. 
AddDbContext )
<) * 
ApplicationDbContext* >
>> ?
(? @
options@ G
=>H J
options 
. 
UseSqlServer $
($ %
connectionString% 5
)5 6
)6 7
;7 8
builder 
. 
Services 
. 3
'AddDatabaseDeveloperPageExceptionFilter D
(D E
)E F
;F G
builder 
. 
Services 
. 
AddDefaultIdentity /
</ 0
IdentityUser0 <
>< =
(= >
options> E
=>F H
optionsI P
.P Q
SignInQ W
.W X#
RequireConfirmedAccountX o
=p q
falser w
)w x
. 
AddRoles 
< 
IdentityRole '
>' (
(( )
)) *
. $
AddEntityFrameworkStores )
<) * 
ApplicationDbContext* >
>> ?
(? @
)@ A
;A B
builder   
.   
Services   
.   #
AddControllersWithViews   4
(  4 5
)  5 6
;  6 7
var"" 
app"" 
="" 
builder"" 
."" 
Build"" #
(""# $
)""$ %
;""% &
if&& 
(&& 
app&& 
.&& 
Environment&& 
.&&  
IsDevelopment&&  -
(&&- .
)&&. /
)&&/ 0
{'' 
app(( 
.(( !
UseMigrationsEndPoint(( )
((() *
)((* +
;((+ ,
})) 
else** 
{++ 
app,, 
.,, 
UseExceptionHandler,, '
(,,' (
$str,,( 5
),,5 6
;,,6 7
app.. 
... 
UseHsts.. 
(.. 
).. 
;.. 
}// 
app11 
.11 
UseHttpsRedirection11 #
(11# $
)11$ %
;11% &
app22 
.22 
UseStaticFiles22 
(22 
)22  
;22  !
app44 
.44 

UseRouting44 
(44 
)44 
;44 
app66 
.66 
UseAuthentication66 !
(66! "
)66" #
;66# $
app77 
.77 
UseAuthorization77  
(77  !
)77! "
;77" #
app99 
.99 
MapControllerRoute99 "
(99" #
name:: 
::: 
$str:: 
,::  
pattern;; 
:;; 
$str;; A
);;A B
;;;B C
app<< 
.<< 
MapRazorPages<< 
(<< 
)<< 
;<<  
using>> 
(>> 
var>> 
scope>> 
=>> 
app>> "
.>>" #
Services>># +
.>>+ ,
CreateScope>>, 7
(>>7 8
)>>8 9
)>>9 :
{?? 
var@@ 
roleManager@@ 
=@@  !
scope@@" '
.@@' (
ServiceProvider@@( 7
.@@7 8
GetRequiredService@@8 J
<@@J K
RoleManager@@K V
<@@V W
IdentityRole@@W c
>@@c d
>@@d e
(@@e f
)@@f g
;@@g h
varAA 
rolesAA 
=AA 
newAA 
[AA  
]AA  !
{AA" #
$strAA$ +
,AA+ ,
$strAA- 3
}AA4 5
;AA5 6
foreachBB 
(BB 
varBB 
roleBB !
inBB" $
rolesBB% *
)BB* +
{CC 
ifDD 
(DD 
!DD 
awaitDD 
roleManagerDD *
.DD* +
RoleExistsAsyncDD+ :
(DD: ;
roleDD; ?
)DD? @
)DD@ A
awaitFF 
roleManagerFF )
.FF) *
CreateAsyncFF* 5
(FF5 6
newFF6 9
IdentityRoleFF: F
(FFF G
roleFFG K
)FFK L
)FFL M
;FFM N
}II 
}JJ 
usingMM 
(MM 
varMM 
scopeMM 
=MM 
appMM "
.MM" #
ServicesMM# +
.MM+ ,
CreateScopeMM, 7
(MM7 8
)MM8 9
)MM9 :
{NN 
varOO 
userManagerOO 
=OO  !
scopePP 
.PP 
ServiceProviderPP )
.PP) *
GetRequiredServicePP* <
<PP< =
UserManagerPP= H
<PPH I
IdentityUserPPI U
>PPU V
>PPV W
(PPW X
)PPX Y
;PPY Z
stringQQ 
emailQQ 
=QQ 
$strQQ +
;QQ+ ,
stringRR 
passwordRR 
=RR  !
$strRR" .
;RR. /
ifTT 
(TT 
awaitTT 
userManagerTT $
.TT$ %
FindByEmailAsyncTT% 5
(TT5 6
emailTT6 ;
)TT; <
==TT= ?
nullTT? C
)TTC D
{UU 
varVV 
userVV 
=VV 
newVV "
IdentityUserVV# /
(VV/ 0
)VV0 1
;VV1 2
userXX 
.XX 
UserNameXX !
=XX" #
emailXX$ )
;XX) *
userYY 
.YY 
EmailYY 
=YY  
emailYY! &
;YY& '
await[[ 
userManager[[ %
.[[% &
CreateAsync[[& 1
([[1 2
user[[2 6
,[[6 7
password[[8 @
)[[@ A
;[[A B
await]] 
userManager]] $
.]]$ %
AddToRoleAsync]]% 3
(]]3 4
user]]4 8
,]]8 9
$str]]: A
)]]A B
;]]B C
}__ 
}`` 
appcc 
.cc 
Runcc 
(cc 
)cc 
;cc 
}ee 	
}ff 
}gg 
GC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Models\Consumption.cs
	namespace 	
waterprj
 
. 
Models 
{ 
public 

class 
Consumption 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
UserId

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
[ 	
Display	 
( 
Name 
= 
$str 
) 
]  
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! @
)@ A
]A B
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
double 
Volume 
{ 
get "
;" #
set$ '
;' (
}) *
} 
public 

static 
class %
ClaimsPrincipalExtensions 1
{ 
public 
static 
string 
? 
	getUserId '
(' (
this( ,
ClaimsPrincipal- <
user= A
)A B
{ 	
if 
( 
user 
== 
null 
|| 
!  !
user! %
.% &
Identity& .
.. /
IsAuthenticated/ >
)> ?
{ 
return 
null 
; 
} 
var 
currentUser 
= 
user "
;" #
var 
nameIdentifierClaim #
=$ %
currentUser& 1
.1 2
	FindFirst2 ;
(; <

ClaimTypes< F
.F G
NameIdentifierG U
)U V
;V W
if   
(   
nameIdentifierClaim   #
==  $ &
null  ' +
)  + ,
{!! 
return"" 
null"" 
;"" 
}## 
return%% 
nameIdentifierClaim%% &
.%%& '
Value%%' ,
;%%, -
}&& 	
}'' 
}(( «
iC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240329233741_UpdateEstimationModel.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class !
UpdateEstimationModel .
:/ 0
	Migration1 :
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} º%
gC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240317135916_estimationMigration.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
estimationMigration ,
:- .
	Migration/ 8
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Date 
= 
table  
.  !
Column! '
<' (
DateTime( 0
>0 1
(1 2
type2 6
:6 7
$str8 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
EstimatedVolume #
=$ %
table& +
.+ ,
Column, 2
<2 3
double3 9
>9 :
(: ;
type; ?
:? @
$strA H
,H I
nullableJ R
:R S
falseT Y
)Y Z
,Z [
NumberOfPeople "
=# $
table% *
.* +
Column+ 1
<1 2
int2 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
,T U
HasPool 
= 
table #
.# $
Column$ *
<* +
bool+ /
>/ 0
(0 1
type1 5
:5 6
$str7 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
UsesDishwasher "
=# $
table% *
.* +
Column+ 1
<1 2
bool2 6
>6 7
(7 8
type8 <
:< =
$str> C
,C D
nullableE M
:M N
falseO T
)T U
,U V
LaundryFrequency $
=% &
table' ,
., -
Column- 3
<3 4
int4 7
>7 8
(8 9
type9 =
:= >
$str? D
,D E
nullableF N
:N O
falseP U
)U V
,V W
ShowerDuration "
=# $
table% *
.* +
Column+ 1
<1 2
int2 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
,T U
LeakDetection !
=" #
table$ )
.) *
Column* 0
<0 1
bool1 5
>5 6
(6 7
type7 ;
:; <
$str= B
,B C
nullableD L
:L M
falseN S
)S T
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 4
,4 5
x6 7
=>8 :
x; <
.< =
Id= ?
)? @
;@ A
} 
) 
; 
}   	
	protected"" 
override"" 
void"" 
Down""  $
(""$ %
MigrationBuilder""% 5
migrationBuilder""6 F
)""F G
{## 	
migrationBuilder$$ 
.$$ 
	DropTable$$ &
($$& '
name%% 
:%% 
$str%% "
)%%" #
;%%# $
}&& 	
}'' 
}(( ä
dC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\20240317124627_initialMigration.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
initialMigration )
:* +
	Migration, 5
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Date 
= 
table  
.  !
Column! '
<' (
DateTime( 0
>0 1
(1 2
type2 6
:6 7
$str8 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
Volume 
= 
table "
." #
Column# )
<) *
double* 0
>0 1
(1 2
type2 6
:6 7
$str8 ?
,? @
nullableA I
:I J
falseK P
)P Q
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str #
)# $
;$ %
}   	
}!! 
}"" þµ
hC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\Migrations\00000000000000_CreateIdentitySchema.cs
	namespace 	
waterprj
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class  
CreateIdentitySchema -
:. /
	Migration0 9
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
	maxLength0 9
:9 :
$num; >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
	maxLength: C
:C D
$numE H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
nullable< D
:D E
trueF J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
	maxLength4 =
:= >
$num? B
,B C
nullableD L
:L M
trueN R
)R S
,S T
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
Email   
=   
table   !
.  ! "
Column  " (
<  ( )
string  ) /
>  / 0
(  0 1
	maxLength  1 :
:  : ;
$num  < ?
,  ? @
nullable  A I
:  I J
true  K O
)  O P
,  P Q
NormalizedEmail!! #
=!!$ %
table!!& +
.!!+ ,
Column!!, 2
<!!2 3
string!!3 9
>!!9 :
(!!: ;
	maxLength!!; D
:!!D E
$num!!F I
,!!I J
nullable!!K S
:!!S T
true!!U Y
)!!Y Z
,!!Z [
EmailConfirmed"" "
=""# $
table""% *
.""* +
Column""+ 1
<""1 2
bool""2 6
>""6 7
(""7 8
nullable""8 @
:""@ A
false""B G
)""G H
,""H I
PasswordHash##  
=##! "
table### (
.##( )
Column##) /
<##/ 0
string##0 6
>##6 7
(##7 8
nullable##8 @
:##@ A
true##B F
)##F G
,##G H
SecurityStamp$$ !
=$$" #
table$$$ )
.$$) *
Column$$* 0
<$$0 1
string$$1 7
>$$7 8
($$8 9
nullable$$9 A
:$$A B
true$$C G
)$$G H
,$$H I
ConcurrencyStamp%% $
=%%% &
table%%' ,
.%%, -
Column%%- 3
<%%3 4
string%%4 :
>%%: ;
(%%; <
nullable%%< D
:%%D E
true%%F J
)%%J K
,%%K L
PhoneNumber&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
string&&/ 5
>&&5 6
(&&6 7
nullable&&7 ?
:&&? @
true&&A E
)&&E F
,&&F G 
PhoneNumberConfirmed'' (
='') *
table''+ 0
.''0 1
Column''1 7
<''7 8
bool''8 <
>''< =
(''= >
nullable''> F
:''F G
false''H M
)''M N
,''N O
TwoFactorEnabled(( $
=((% &
table((' ,
.((, -
Column((- 3
<((3 4
bool((4 8
>((8 9
(((9 :
nullable((: B
:((B C
false((D I
)((I J
,((J K

LockoutEnd)) 
=))  
table))! &
.))& '
Column))' -
<))- .
DateTimeOffset)). <
>))< =
())= >
nullable))> F
:))F G
true))H L
)))L M
,))M N
LockoutEnabled** "
=**# $
table**% *
.*** +
Column**+ 1
<**1 2
bool**2 6
>**6 7
(**7 8
nullable**8 @
:**@ A
false**B G
)**G H
,**H I
AccessFailedCount++ %
=++& '
table++( -
.++- .
Column++. 4
<++4 5
int++5 8
>++8 9
(++9 :
nullable++: B
:++B C
false++D I
)++I J
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 5
,//5 6
x//7 8
=>//9 ;
x//< =
.//= >
Id//> @
)//@ A
;//A B
}00 
)00 
;00 
migrationBuilder22 
.22 
CreateTable22 (
(22( )
name33 
:33 
$str33 (
,33( )
columns44 
:44 
table44 
=>44 !
new44" %
{55 
Id66 
=66 
table66 
.66 
Column66 %
<66% &
int66& )
>66) *
(66* +
nullable66+ 3
:663 4
false665 :
)66: ;
.77 

Annotation77 #
(77# $
$str77$ G
,77G H,
 SqlServerValueGenerationStrategy77I i
.77i j
IdentityColumn77j x
)77x y
,77y z
RoleId88 
=88 
table88 "
.88" #
Column88# )
<88) *
string88* 0
>880 1
(881 2
nullable882 :
:88: ;
false88< A
)88A B
,88B C
	ClaimType99 
=99 
table99  %
.99% &
Column99& ,
<99, -
string99- 3
>993 4
(994 5
nullable995 =
:99= >
true99? C
)99C D
,99D E

ClaimValue:: 
=::  
table::! &
.::& '
Column::' -
<::- .
string::. 4
>::4 5
(::5 6
nullable::6 >
:::> ?
true::@ D
)::D E
};; 
,;; 
constraints<< 
:<< 
table<< "
=><<# %
{== 
table>> 
.>> 

PrimaryKey>> $
(>>$ %
$str>>% :
,>>: ;
x>>< =
=>>>> @
x>>A B
.>>B C
Id>>C E
)>>E F
;>>F G
table?? 
.?? 

ForeignKey?? $
(??$ %
name@@ 
:@@ 
$str@@ F
,@@F G
columnAA 
:AA 
xAA  !
=>AA" $
xAA% &
.AA& '
RoleIdAA' -
,AA- .
principalTableBB &
:BB& '
$strBB( 5
,BB5 6
principalColumnCC '
:CC' (
$strCC) -
,CC- .
onDeleteDD  
:DD  !
ReferentialActionDD" 3
.DD3 4
CascadeDD4 ;
)DD; <
;DD< =
}EE 
)EE 
;EE 
migrationBuilderGG 
.GG 
CreateTableGG (
(GG( )
nameHH 
:HH 
$strHH (
,HH( )
columnsII 
:II 
tableII 
=>II !
newII" %
{JJ 
IdKK 
=KK 
tableKK 
.KK 
ColumnKK %
<KK% &
intKK& )
>KK) *
(KK* +
nullableKK+ 3
:KK3 4
falseKK5 :
)KK: ;
.LL 

AnnotationLL #
(LL# $
$strLL$ G
,LLG H,
 SqlServerValueGenerationStrategyLLI i
.LLi j
IdentityColumnLLj x
)LLx y
,LLy z
UserIdMM 
=MM 
tableMM "
.MM" #
ColumnMM# )
<MM) *
stringMM* 0
>MM0 1
(MM1 2
nullableMM2 :
:MM: ;
falseMM< A
)MMA B
,MMB C
	ClaimTypeNN 
=NN 
tableNN  %
.NN% &
ColumnNN& ,
<NN, -
stringNN- 3
>NN3 4
(NN4 5
nullableNN5 =
:NN= >
trueNN? C
)NNC D
,NND E

ClaimValueOO 
=OO  
tableOO! &
.OO& '
ColumnOO' -
<OO- .
stringOO. 4
>OO4 5
(OO5 6
nullableOO6 >
:OO> ?
trueOO@ D
)OOD E
}PP 
,PP 
constraintsQQ 
:QQ 
tableQQ "
=>QQ# %
{RR 
tableSS 
.SS 

PrimaryKeySS $
(SS$ %
$strSS% :
,SS: ;
xSS< =
=>SS> @
xSSA B
.SSB C
IdSSC E
)SSE F
;SSF G
tableTT 
.TT 

ForeignKeyTT $
(TT$ %
nameUU 
:UU 
$strUU F
,UUF G
columnVV 
:VV 
xVV  !
=>VV" $
xVV% &
.VV& '
UserIdVV' -
,VV- .
principalTableWW &
:WW& '
$strWW( 5
,WW5 6
principalColumnXX '
:XX' (
$strXX) -
,XX- .
onDeleteYY  
:YY  !
ReferentialActionYY" 3
.YY3 4
CascadeYY4 ;
)YY; <
;YY< =
}ZZ 
)ZZ 
;ZZ 
migrationBuilder\\ 
.\\ 
CreateTable\\ (
(\\( )
name]] 
:]] 
$str]] (
,]]( )
columns^^ 
:^^ 
table^^ 
=>^^ !
new^^" %
{__ 
LoginProvider`` !
=``" #
table``$ )
.``) *
Column``* 0
<``0 1
string``1 7
>``7 8
(``8 9
	maxLength``9 B
:``B C
$num``D G
,``G H
nullable``I Q
:``Q R
false``S X
)``X Y
,``Y Z
ProviderKeyaa 
=aa  !
tableaa" '
.aa' (
Columnaa( .
<aa. /
stringaa/ 5
>aa5 6
(aa6 7
	maxLengthaa7 @
:aa@ A
$numaaB E
,aaE F
nullableaaG O
:aaO P
falseaaQ V
)aaV W
,aaW X
ProviderDisplayNamebb '
=bb( )
tablebb* /
.bb/ 0
Columnbb0 6
<bb6 7
stringbb7 =
>bb= >
(bb> ?
nullablebb? G
:bbG H
truebbI M
)bbM N
,bbN O
UserIdcc 
=cc 
tablecc "
.cc" #
Columncc# )
<cc) *
stringcc* 0
>cc0 1
(cc1 2
nullablecc2 :
:cc: ;
falsecc< A
)ccA B
}dd 
,dd 
constraintsee 
:ee 
tableee "
=>ee# %
{ff 
tablegg 
.gg 

PrimaryKeygg $
(gg$ %
$strgg% :
,gg: ;
xgg< =
=>gg> @
newggA D
{ggE F
xggG H
.ggH I
LoginProviderggI V
,ggV W
xggX Y
.ggY Z
ProviderKeyggZ e
}ggf g
)ggg h
;ggh i
tablehh 
.hh 

ForeignKeyhh $
(hh$ %
nameii 
:ii 
$strii F
,iiF G
columnjj 
:jj 
xjj  !
=>jj" $
xjj% &
.jj& '
UserIdjj' -
,jj- .
principalTablekk &
:kk& '
$strkk( 5
,kk5 6
principalColumnll '
:ll' (
$strll) -
,ll- .
onDeletemm  
:mm  !
ReferentialActionmm" 3
.mm3 4
Cascademm4 ;
)mm; <
;mm< =
}nn 
)nn 
;nn 
migrationBuilderpp 
.pp 
CreateTablepp (
(pp( )
nameqq 
:qq 
$strqq '
,qq' (
columnsrr 
:rr 
tablerr 
=>rr !
newrr" %
{ss 
UserIdtt 
=tt 
tablett "
.tt" #
Columntt# )
<tt) *
stringtt* 0
>tt0 1
(tt1 2
nullablett2 :
:tt: ;
falsett< A
)ttA B
,ttB C
RoleIduu 
=uu 
tableuu "
.uu" #
Columnuu# )
<uu) *
stringuu* 0
>uu0 1
(uu1 2
nullableuu2 :
:uu: ;
falseuu< A
)uuA B
}vv 
,vv 
constraintsww 
:ww 
tableww "
=>ww# %
{xx 
tableyy 
.yy 

PrimaryKeyyy $
(yy$ %
$stryy% 9
,yy9 :
xyy; <
=>yy= ?
newyy@ C
{yyD E
xyyF G
.yyG H
UserIdyyH N
,yyN O
xyyP Q
.yyQ R
RoleIdyyR X
}yyY Z
)yyZ [
;yy[ \
tablezz 
.zz 

ForeignKeyzz $
(zz$ %
name{{ 
:{{ 
$str{{ E
,{{E F
column|| 
:|| 
x||  !
=>||" $
x||% &
.||& '
RoleId||' -
,||- .
principalTable}} &
:}}& '
$str}}( 5
,}}5 6
principalColumn~~ '
:~~' (
$str~~) -
,~~- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
table
 
.
 

ForeignKey
 $
(
$ %
name
 
:
 
$str
 E
,
E F
column
 
:
 
x
  !
=>
" $
x
% &
.
& '
UserId
' -
,
- .
principalTable
 &
:
& '
$str
( 5
,
5 6
principalColumn
 '
:
' (
$str
) -
,
- .
onDelete
  
:
  !
ReferentialAction
" 3
.
3 4
Cascade
4 ;
)
; <
;
< =
}
 
)
 
;
 
migrationBuilder
 
.
 
CreateTable
 (
(
( )
name
 
:
 
$str
 (
,
( )
columns
 
:
 
table
 
=>
 !
new
" %
{
 
UserId
 
=
 
table
 "
.
" #
Column
# )
<
) *
string
* 0
>
0 1
(
1 2
nullable
2 :
:
: ;
false
< A
)
A B
,
B C
LoginProvider
 !
=
" #
table
$ )
.
) *
Column
* 0
<
0 1
string
1 7
>
7 8
(
8 9
	maxLength
9 B
:
B C
$num
D G
,
G H
nullable
I Q
:
Q R
false
S X
)
X Y
,
Y Z
Name
 
=
 
table
  
.
  !
Column
! '
<
' (
string
( .
>
. /
(
/ 0
	maxLength
0 9
:
9 :
$num
; >
,
> ?
nullable
@ H
:
H I
false
J O
)
O P
,
P Q
Value
 
=
 
table
 !
.
! "
Column
" (
<
( )
string
) /
>
/ 0
(
0 1
nullable
1 9
:
9 :
true
; ?
)
? @
}
 
,
 
constraints
 
:
 
table
 "
=>
# %
{
 
table
 
.
 

PrimaryKey
 $
(
$ %
$str
% :
,
: ;
x
< =
=>
> @
new
A D
{
E F
x
G H
.
H I
UserId
I O
,
O P
x
Q R
.
R S
LoginProvider
S `
,
` a
x
b c
.
c d
Name
d h
}
i j
)
j k
;
k l
table
 
.
 

ForeignKey
 $
(
$ %
name
 
:
 
$str
 F
,
F G
column
 
:
 
x
  !
=>
" $
x
% &
.
& '
UserId
' -
,
- .
principalTable
 &
:
& '
$str
( 5
,
5 6
principalColumn
 '
:
' (
$str
) -
,
- .
onDelete
  
:
  !
ReferentialAction
" 3
.
3 4
Cascade
4 ;
)
; <
;
< =
}
 
)
 
;
 
migrationBuilder
 
.
 
CreateIndex
 (
(
( )
name
 
:
 
$str
 2
,
2 3
table
 
:
 
$str
 )
,
) *
column
 
:
 
$str
  
)
  !
;
! "
migrationBuilder
¡¡ 
.
¡¡ 
CreateIndex
¡¡ (
(
¡¡( )
name
¢¢ 
:
¢¢ 
$str
¢¢ %
,
¢¢% &
table
££ 
:
££ 
$str
££ $
,
££$ %
column
¤¤ 
:
¤¤ 
$str
¤¤ (
,
¤¤( )
unique
¥¥ 
:
¥¥ 
true
¥¥ 
,
¥¥ 
filter
¦¦ 
:
¦¦ 
$str
¦¦ 6
)
¦¦6 7
;
¦¦7 8
migrationBuilder
¨¨ 
.
¨¨ 
CreateIndex
¨¨ (
(
¨¨( )
name
©© 
:
©© 
$str
©© 2
,
©©2 3
table
ªª 
:
ªª 
$str
ªª )
,
ªª) *
column
«« 
:
«« 
$str
««  
)
««  !
;
««! "
migrationBuilder
­­ 
.
­­ 
CreateIndex
­­ (
(
­­( )
name
®® 
:
®® 
$str
®® 2
,
®®2 3
table
¯¯ 
:
¯¯ 
$str
¯¯ )
,
¯¯) *
column
°° 
:
°° 
$str
°°  
)
°°  !
;
°°! "
migrationBuilder
²² 
.
²² 
CreateIndex
²² (
(
²²( )
name
³³ 
:
³³ 
$str
³³ 1
,
³³1 2
table
´´ 
:
´´ 
$str
´´ (
,
´´( )
column
µµ 
:
µµ 
$str
µµ  
)
µµ  !
;
µµ! "
migrationBuilder
·· 
.
·· 
CreateIndex
·· (
(
··( )
name
¸¸ 
:
¸¸ 
$str
¸¸ "
,
¸¸" #
table
¹¹ 
:
¹¹ 
$str
¹¹ $
,
¹¹$ %
column
ºº 
:
ºº 
$str
ºº )
)
ºº) *
;
ºº* +
migrationBuilder
¼¼ 
.
¼¼ 
CreateIndex
¼¼ (
(
¼¼( )
name
½½ 
:
½½ 
$str
½½ %
,
½½% &
table
¾¾ 
:
¾¾ 
$str
¾¾ $
,
¾¾$ %
column
¿¿ 
:
¿¿ 
$str
¿¿ ,
,
¿¿, -
unique
ÀÀ 
:
ÀÀ 
true
ÀÀ 
,
ÀÀ 
filter
ÁÁ 
:
ÁÁ 
$str
ÁÁ :
)
ÁÁ: ;
;
ÁÁ; <
}
ÂÂ 	
	protected
ÄÄ 
override
ÄÄ 
void
ÄÄ 
Down
ÄÄ  $
(
ÄÄ$ %
MigrationBuilder
ÄÄ% 5
migrationBuilder
ÄÄ6 F
)
ÄÄF G
{
ÅÅ 	
migrationBuilder
ÆÆ 
.
ÆÆ 
	DropTable
ÆÆ &
(
ÆÆ& '
name
ÇÇ 
:
ÇÇ 
$str
ÇÇ (
)
ÇÇ( )
;
ÇÇ) *
migrationBuilder
ÉÉ 
.
ÉÉ 
	DropTable
ÉÉ &
(
ÉÉ& '
name
ÊÊ 
:
ÊÊ 
$str
ÊÊ (
)
ÊÊ( )
;
ÊÊ) *
migrationBuilder
ÌÌ 
.
ÌÌ 
	DropTable
ÌÌ &
(
ÌÌ& '
name
ÍÍ 
:
ÍÍ 
$str
ÍÍ (
)
ÍÍ( )
;
ÍÍ) *
migrationBuilder
ÏÏ 
.
ÏÏ 
	DropTable
ÏÏ &
(
ÏÏ& '
name
ÐÐ 
:
ÐÐ 
$str
ÐÐ '
)
ÐÐ' (
;
ÐÐ( )
migrationBuilder
ÒÒ 
.
ÒÒ 
	DropTable
ÒÒ &
(
ÒÒ& '
name
ÓÓ 
:
ÓÓ 
$str
ÓÓ (
)
ÓÓ( )
;
ÓÓ) *
migrationBuilder
ÕÕ 
.
ÕÕ 
	DropTable
ÕÕ &
(
ÕÕ& '
name
ÖÖ 
:
ÖÖ 
$str
ÖÖ #
)
ÖÖ# $
;
ÖÖ$ %
migrationBuilder
ØØ 
.
ØØ 
	DropTable
ØØ &
(
ØØ& '
name
ÙÙ 
:
ÙÙ 
$str
ÙÙ #
)
ÙÙ# $
;
ÙÙ$ %
}
ÚÚ 	
}
ÛÛ 
}ÜÜ Ú	
NC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Data\ApplicationDbContext.cs
	namespace 	
waterprj
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
IdentityDbContext( 9
{ 
public		  
ApplicationDbContext		 #
(		# $
DbContextOptions		$ 4
<		4 5 
ApplicationDbContext		5 I
>		I J
options		K R
)		R S
:

 
base

 
(

 
options

 
)

 
{ 	
} 	
public 
DbSet 
< 
waterprj 
. 
Models $
.$ %
Consumption% 0
>0 1
?1 2
Consumption3 >
{? @
getA D
;D E
setF I
;I J
}K L
public 
DbSet 
< 
waterprj 
. 
Models $
.$ %

Estimation% /
>/ 0
?0 1

Estimation2 <
{= >
get? B
;B C
setD G
;G H
}I J
} 
} è
OC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\HomeController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
}   ñ
UC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\EstimationController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class  
EstimationController %
:& '

Controller( 2
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public  
EstimationController #
(# $ 
ApplicationDbContext$ 8
context9 @
,A B 
IHttpContextAccessorC W
httpContextAccessorX k
)k l
{ 	
_context 
= 
context 
;  
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
} 	
public
 
async 
Task 
< 
IActionResult )
>) *
Index+ 0
(0 1
)1 2
{   
if!! 
(!! 
TempData!! 
[!! 
$str!! *
]!!* +
!=!!, .
null!!/ 3
)!!3 4
{"" 
ViewBag## 
.## 
SuccessMessage## 
=##  
TempData##! )
[##) *
$str##* :
]##: ;
;##; <
}$$ 
return%% 
_context%%  
.%%  !

Estimation%%! +
!=%%, .
null%%/ 3
?%%4 5
View&& !
(&&! "
await&&" '
_context&&( 0
.&&0 1

Estimation&&1 ;
.&&; <
ToListAsync&&< G
(&&G H
)&&H I
)&&I J
:&&K L
Problem'' $
(''$ %
$str''% ]
)''] ^
;''^ _
}(( 
[,, 	
HttpPost,,	 
],, 
[-- 	$
ValidateAntiForgeryToken--	 !
]--! "
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' (&
CalculateAndSaveEstimation..) C
(..C D
[..D E
Bind..E I
(..I J
$str	..J 
)
..  
]
..  ¡

Estimation
..¢ ¬

estimation
..­ ·
)
..· ¸
{// 	
if00 
(00 

ModelState00 
.00 
IsValid00 "
)00" #
{11 

estimation44 
.44 
Date44 
=44  !
DateTime44" *
.44* +
Now44+ .
;44. /
double77 
estimatedVolume77 &
=77' (
CalculateEstimation77) <
(77< =

estimation77= G
)77G H
;77H I

estimation:: 
.:: 
EstimatedVolume:: *
=::+ ,
estimatedVolume::- <
;::< =
_context== 
.== 

Estimation== #
.==# $
Add==$ '
(==' (

estimation==( 2
)==2 3
;==3 4
await>> 
_context>> 
.>> 
SaveChangesAsync>> /
(>>/ 0
)>>0 1
;>>1 2
TempDataAA 
[AA 
$strAA +
]AA+ ,
=AA- .
estimatedVolumeAA/ >
.AA> ?
ToStringAA? G
(AAG H
)AAH I
;AAI J
returnDD 
RedirectToActionDD '
(DD' (
nameofDD( .
(DD. /
IndexDD/ 4
)DD4 5
)DD5 6
;DD6 7
}EE 
returnHH 
ViewHH 
(HH 
$strHH  
,HH  !

estimationHH! +
)HH+ ,
;HH, -
}II 	
privateQQ 
doubleQQ 
CalculateEstimationQQ *
(QQ* +

EstimationQQ+ 5

estimationQQ6 @
)QQ@ A
{RR 	
doubleUU 

baseVolumeUU 
=UU 
$numUU  #
;UU# $
doubleVV 

poolFactorVV 
=VV 

estimationVV  *
.VV* +
HasPoolVV+ 2
?VV3 4
$numVV5 7
:VV8 9
$numVV: ;
;VV; <
doubleWW 
dishwasherFactorWW #
=WW$ %

estimationWW& 0
.WW0 1
UsesDishwasherWW1 ?
?WW@ A
$numWWB D
:WWE F
$numWWG H
;WWH I
doubleYY 
totalVolumeYY 
=YY  

baseVolumeYY! +
+YY, -
(YY. /

estimationYY/ 9
.YY9 :
NumberOfPeopleYY: H
*YYI J
$numYYK M
)YYM N
+YYO P

poolFactorYYQ [
+YY\ ]
dishwasherFactorYY^ n
;YYn o
returnZZ 
totalVolumeZZ 
;ZZ 
}[[ 	
public^^ 
async^^ 
Task^^ 
<^^ 
IActionResult^^ '
>^^' (
Details^^) 0
(^^0 1
int^^1 4
?^^4 5
id^^6 8
)^^8 9
{__ 	
if`` 
(`` 
id`` 
==`` 
null`` 
||`` 
_context`` &
.``& '

Estimation``' 1
==``2 4
null``5 9
)``9 :
{aa 
returnbb 
NotFoundbb 
(bb  
)bb  !
;bb! "
}cc 
varee 

estimationee 
=ee 
awaitee "
_contextee# +
.ee+ ,

Estimationee, 6
.ff 
FirstOrDefaultAsyncff $
(ff$ %
mff% &
=>ff' )
mff* +
.ff+ ,
Idff, .
==ff/ 1
idff2 4
)ff4 5
;ff5 6
ifgg 
(gg 

estimationgg 
==gg 
nullgg "
)gg" #
{hh 
returnii 
NotFoundii 
(ii  
)ii  !
;ii! "
}jj 
returnll 
Viewll 
(ll 

estimationll "
)ll" #
;ll# $
}mm 	
publicpp 
IActionResultpp 
Createpp #
(pp# $
)pp$ %
{qq 	
returnrr 
Viewrr 
(rr 
)rr 
;rr 
}ss 	
[xx 	
HttpPostxx	 
]xx 
[yy 	$
ValidateAntiForgeryTokenyy	 !
]yy! "
publiczz 
asynczz 
Taskzz 
<zz 
IActionResultzz '
>zz' (
Createzz) /
(zz/ 0
[zz0 1
Bindzz1 5
(zz5 6
$str	zz6 §
)
zz§ ¨
]
zz¨ ©

Estimation
zzª ´

estimation
zzµ ¿
)
zz¿ À
{{{ 	
if|| 
(|| 

ModelState|| 
.|| 
IsValid|| "
)||" #
{}} 
if~~ 
(~~ 

estimation~~ 
.~~ 
EstimatedVolume~~ .
==~~/ 1
null~~2 6
)~~6 7
{ 
double
 
estimatedVolume
 *
=
+ ,!
CalculateEstimation
- @
(
@ A

estimation
A K
)
K L
;
L M

estimation
 
.
 
EstimatedVolume
 .
=
/ 0
estimatedVolume
1 @
;
@ A
}
 
_context
 
.
 
Add
 
(
 

estimation
 '
)
' (
;
( )
await
 
_context
 
.
 
SaveChangesAsync
 /
(
/ 0
)
0 1
;
1 2
TempData
 
[
 
$str
 )
]
) *
=
+ ,
$str
- b
+
c d

estimation
e o
.
o p
EstimatedVolume
p 
+ 
$str 
; 
return
 
RedirectToAction
 '
(
' (
nameof
( .
(
. /
Index
/ 4
)
4 5
)
5 6
;
6 7
}
 
return
 
View
 
(
 

estimation
 "
)
" #
;
# $
}
 	
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
Edit
) -
(
- .
int
. 1
?
1 2
id
3 5
)
5 6
{
 	
if
 
(
 
id
 
==
 
null
 
||
 
_context
 &
.
& '

Estimation
' 1
==
2 4
null
5 9
)
9 :
{
 
return
 
NotFound
 
(
  
)
  !
;
! "
}
 
var
 

estimation
 
=
 
await
 "
_context
# +
.
+ ,

Estimation
, 6
.
6 7
	FindAsync
7 @
(
@ A
id
A C
)
C D
;
D E
if
 
(
 

estimation
 
==
 
null
 "
)
" #
{
 
return
 
NotFound
 
(
  
)
  !
;
! "
}
 
return
 
View
 
(
 

estimation
 "
)
" #
;
# $
}
 	
[
££ 	
HttpPost
££	 
]
££ 
[
¤¤ 	&
ValidateAntiForgeryToken
¤¤	 !
]
¤¤! "
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 
IActionResult
¥¥ '
>
¥¥' (
Edit
¥¥) -
(
¥¥- .
int
¥¥. 1
id
¥¥2 4
,
¥¥4 5
[
¥¥6 7
Bind
¥¥7 ;
(
¥¥; <
$str¥¥< °
)¥¥° ±
]¥¥± ²

Estimation¥¥³ ½

estimation¥¥¾ È
)¥¥È É
{
¦¦ 	
if
§§ 
(
§§ 
id
§§ 
!=
§§ 

estimation
§§  
.
§§  !
Id
§§! #
)
§§# $
{
¨¨ 
return
©© 
NotFound
©© 
(
©©  
)
©©  !
;
©©! "
}
ªª 
if
¬¬ 
(
¬¬ 

ModelState
¬¬ 
.
¬¬ 
IsValid
¬¬ "
)
¬¬" #
{
­­ 
try
®® 
{
¯¯ 
var
±±  
originalEstimation
±± *
=
±±+ ,
await
±±- 2
_context
±±3 ;
.
±±; <

Estimation
±±< F
.
±±F G
AsNoTracking
±±G S
(
±±S T
)
±±T U
.
±±U V!
FirstOrDefaultAsync
±±V i
(
±±i j
e
±±j k
=>
±±l n
e
±±o p
.
±±p q
Id
±±q s
==
±±t v

estimation±±w 
.±± 
Id±± 
)±± 
;±± 
if
³³ 
(
³³  
originalEstimation
³³ *
==
³³+ -
null
³³. 2
)
³³2 3
{
´´ 
return
µµ 
NotFound
µµ '
(
µµ' (
)
µµ( )
;
µµ) *
}
¶¶ 
if
¹¹ 
(
¹¹ 

estimation
¹¹ "
.
¹¹" #
EstimatedVolume
¹¹# 2
==
¹¹3 5
null
¹¹6 :
)
¹¹: ;
{
ºº 
double
»»  
newEstimatedVolume
»» 1
=
»»2 3!
CalculateEstimation
»»4 G
(
»»G H

estimation
»»H R
)
»»R S
;
»»S T

estimation
¼¼ "
.
¼¼" #
EstimatedVolume
¼¼# 2
=
¼¼3 4 
newEstimatedVolume
¼¼5 G
;
¼¼G H
}
½½ 
if
ÀÀ 
(
ÀÀ (
EstimationValuesAreChanged
ÀÀ 2
(
ÀÀ2 3

estimation
ÀÀ3 =
,
ÀÀ= > 
originalEstimation
ÀÀ? Q
)
ÀÀQ R
)
ÀÀR S
{
ÁÁ 
double
ÃÃ  
newEstimatedVolume
ÃÃ 1
=
ÃÃ2 3!
CalculateEstimation
ÃÃ4 G
(
ÃÃG H

estimation
ÃÃH R
)
ÃÃR S
;
ÃÃS T

estimation
ÄÄ "
.
ÄÄ" #
EstimatedVolume
ÄÄ# 2
=
ÄÄ3 4 
newEstimatedVolume
ÄÄ5 G
;
ÄÄG H
}
ÅÅ 
_context
ÉÉ 
.
ÉÉ 
Update
ÉÉ #
(
ÉÉ# $

estimation
ÉÉ$ .
)
ÉÉ. /
;
ÉÉ/ 0
await
ÊÊ 
_context
ÊÊ "
.
ÊÊ" #
SaveChangesAsync
ÊÊ# 3
(
ÊÊ3 4
)
ÊÊ4 5
;
ÊÊ5 6
TempData
ÍÍ 
[
ÍÍ 
$str
ÍÍ *
]
ÍÍ* +
=
ÍÍ, -
$str
ÍÍ. c
+
ÍÍd e

estimation
ÍÍf p
.
ÍÍp q
EstimatedVolumeÍÍq 
+ÍÍ 
$strÍÍ 
;ÍÍ 
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ *
DbUpdateConcurrencyException
ÏÏ 3
)
ÏÏ3 4
{
ÐÐ 
if
ÑÑ 
(
ÑÑ 
!
ÑÑ 
EstimationExists
ÑÑ )
(
ÑÑ) *

estimation
ÑÑ* 4
.
ÑÑ4 5
Id
ÑÑ5 7
)
ÑÑ7 8
)
ÑÑ8 9
{
ÒÒ 
return
ÓÓ 
NotFound
ÓÓ '
(
ÓÓ' (
)
ÓÓ( )
;
ÓÓ) *
}
ÔÔ 
else
ÕÕ 
{
ÖÖ 
throw
×× 
;
×× 
}
ØØ 
}
ÙÙ 
return
ÚÚ 
RedirectToAction
ÚÚ '
(
ÚÚ' (
nameof
ÚÚ( .
(
ÚÚ. /
Index
ÚÚ/ 4
)
ÚÚ4 5
)
ÚÚ5 6
;
ÚÚ6 7
}
ÛÛ 
return
ÜÜ 
View
ÜÜ 
(
ÜÜ 

estimation
ÜÜ "
)
ÜÜ" #
;
ÜÜ# $
}
ÝÝ 	
private
àà 
bool
àà (
EstimationValuesAreChanged
àà /
(
àà/ 0

Estimation
àà0 :
currentEstimation
àà; L
,
ààL M

Estimation
ààN X 
originalEstimation
ààY k
)
ààk l
{
áá 	
return
ãã 
currentEstimation
ãã $
.
ãã$ %
NumberOfPeople
ãã% 3
!=
ãã4 6 
originalEstimation
ãã7 I
.
ããI J
NumberOfPeople
ããJ X
||
ããY [
currentEstimation
ää $
.
ää$ %
HasPool
ää% ,
!=
ää- / 
originalEstimation
ää0 B
.
ääB C
HasPool
ääC J
||
ääK M
currentEstimation
åå $
.
åå$ %
UsesDishwasher
åå% 3
!=
åå4 6 
originalEstimation
åå7 I
.
ååI J
UsesDishwasher
ååJ X
||
ååY [
currentEstimation
ææ $
.
ææ$ %
LaundryFrequency
ææ% 5
!=
ææ6 8 
originalEstimation
ææ9 K
.
ææK L
LaundryFrequency
ææL \
||
ææ] _
currentEstimation
çç $
.
çç$ %
ShowerDuration
çç% 3
!=
çç4 6 
originalEstimation
çç7 I
.
ççI J
ShowerDuration
ççJ X
||
ççY [
currentEstimation
èè $
.
èè$ %
LeakDetection
èè% 2
!=
èè3 5 
originalEstimation
èè6 H
.
èèH I
LeakDetection
èèI V
;
èèV W
}
éé 	
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
IActionResult
ìì '
>
ìì' (
Delete
ìì) /
(
ìì/ 0
int
ìì0 3
?
ìì3 4
id
ìì5 7
)
ìì7 8
{
íí 	
if
îî 
(
îî 
id
îî 
==
îî 
null
îî 
||
îî 
_context
îî &
.
îî& '

Estimation
îî' 1
==
îî2 4
null
îî5 9
)
îî9 :
{
ïï 
return
ðð 
NotFound
ðð 
(
ðð  
)
ðð  !
;
ðð! "
}
ññ 
var
óó 

estimation
óó 
=
óó 
await
óó "
_context
óó# +
.
óó+ ,

Estimation
óó, 6
.
ôô !
FirstOrDefaultAsync
ôô $
(
ôô$ %
m
ôô% &
=>
ôô' )
m
ôô* +
.
ôô+ ,
Id
ôô, .
==
ôô/ 1
id
ôô2 4
)
ôô4 5
;
ôô5 6
if
õõ 
(
õõ 

estimation
õõ 
==
õõ 
null
õõ "
)
õõ" #
{
öö 
return
÷÷ 
NotFound
÷÷ 
(
÷÷  
)
÷÷  !
;
÷÷! "
}
øø 
return
úú 
View
úú 
(
úú 

estimation
úú "
)
úú" #
;
úú# $
}
ûû 	
[
þþ 	
HttpPost
þþ	 
,
þþ 

ActionName
þþ 
(
þþ 
$str
þþ &
)
þþ& '
]
þþ' (
[
ÿÿ 	&
ValidateAntiForgeryToken
ÿÿ	 !
]
ÿÿ! "
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
DeleteConfirmed
) 8
(
8 9
int
9 <
id
= ?
)
? @
{
 	
if
 
(
 
_context
 
.
 

Estimation
 #
==
$ &
null
' +
)
+ ,
{
 
return
 
Problem
 
(
 
$str
 W
)
W X
;
X Y
}
 
var
 

estimation
 
=
 
await
 "
_context
# +
.
+ ,

Estimation
, 6
.
6 7
	FindAsync
7 @
(
@ A
id
A C
)
C D
;
D E
if
 
(
 

estimation
 
!=
 
null
 "
)
" #
{
 
_context
 
.
 

Estimation
 #
.
# $
Remove
$ *
(
* +

estimation
+ 5
)
5 6
;
6 7
}
 
await
 
_context
 
.
 
SaveChangesAsync
 +
(
+ ,
)
, -
;
- .
return
 
RedirectToAction
 #
(
# $
nameof
$ *
(
* +'
ResetAutoIncrementIfEmpty
+ D
)
D E
)
E F
;
F G
return
 
RedirectToAction
 #
(
# $
nameof
$ *
(
* +
Index
+ 0
)
0 1
)
1 2
;
2 3
}
 	
private
 
bool
 
EstimationExists
 %
(
% &
int
& )
id
* ,
)
, -
{
 	
return

 
(
 
_context
 
.
 

Estimation
 %
?
% &
.
& '
Any
' *
(
* +
e
+ ,
=>
- /
e
0 1
.
1 2
Id
2 4
==
5 7
id
8 :
)
: ;
)
; <
.
< =
GetValueOrDefault
= N
(
N O
)
O P
;
P Q
}
 	
public

 
IActionResult
 '
ResetAutoIncrementIfEmpty
 8
(
8 9
)
9 :
{
 	
if
 
(
 
!
 
_context
 
.
 

Estimation
 $
.
$ %
Any
% (
(
( )
)
) *
)
* +
{
 
_context
 
.
 
Database
 !
.
! "
ExecuteSqlRaw
" /
(
/ 0
$str
0 [
)
[ \
;
\ ]
}
 
return
¡¡ 
RedirectToAction
¡¡ #
(
¡¡# $
nameof
¡¡$ *
(
¡¡* +
Index
¡¡+ 0
)
¡¡0 1
)
¡¡1 2
;
¡¡2 3
}
¢¢ 	
}
££ 
}¤¤ ó¡
VC:\Users\21260\OneDrive\Documents\dotnet\waterprj\Controllers\ConsumptionController.cs
	namespace 	
waterprj
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class !
ConsumptionController &
:' (

Controller) 3
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
_userManager3 ?
;? @
public !
ConsumptionController $
($ %
UserManager% 0
<0 1
IdentityUser1 =
>= >
userManager? J
,J K 
ApplicationDbContextL `
contexta h
)h i
{ 	
_userManager 
= 
userManager &
;& '
_context   
=   
context   
;   
}!! 	
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Index))) .
()). /
)))/ 0
{++ 	
string// 
userId// 
=// 
_userManager// (
.//( )
	GetUserId//) 2
(//2 3
User//3 7
)//7 8
;//8 9
var22 
userConsumptions22  
=22! "
await22# (
_context22) 1
.221 2
Consumption222 =
.33 
Where33 
(33 
c33 
=>33 
c33 
.33 
UserId33 $
==33% '
userId33( .
)33. /
.44 
ToListAsync44 
(44 
)44 
;44 
var77 
userMonthlyData77 
=77  !
userConsumptions77" 2
.88	 

Where88
 
(88 
c88 
=>88 
c88 
.88 
UserId88 
==88  
userId88! '
)88' (
.99	 

GroupBy99
 
(99 
c99 
=>99 
new99 
{99 
Year99 !
=99" #
c99$ %
.99% &
Date99& *
.99* +
Year99+ /
,99/ 0
Month991 6
=997 8
c999 :
.99: ;
Date99; ?
.99? @
Month99@ E
}99F G
)99G H
.::	 


SelectMany::
 
(:: 
g:: 
=>:: 
g:: 
.:: 
Select:: "
(::" #
c::# $
=>::% '
new::( +
{::, -
Month::. 3
=::4 5
$"::6 8
{::8 9
g::9 :
.::: ;
Key::; >
.::> ?
Month::? D
}::D E
$str::E F
{::F G
g::G H
.::H I
Key::I L
.::L M
Year::M Q
}::Q R
"::R S
,::S T
Volume::U [
=::\ ]
c::^ _
.::_ `
Volume::` f
}::g h
)::h i
)::i j
.;;	 

OrderBy;;
 
(;; 
g;; 
=>;; 
g;; 
.;; 
Month;; 
);; 
.<<	 

ToList<<
 
(<< 
)<< 
;<< 
varCC 
userMonthlyDatabarCC "
=CC# $
userConsumptionsCC% 5
.DD 	
WhereDD	 
(DD 
cDD 
=>DD 
cDD 
.DD 
UserIdDD 
==DD 
userIdDD  &
)DD& '
.EE 	
GroupByEE	 
(EE 
cEE 
=>EE 
newEE 
{EE 
YearEE  
=EE! "
cEE# $
.EE$ %
DateEE% )
.EE) *
YearEE* .
,EE. /
MonthEE0 5
=EE6 7
cEE8 9
.EE9 :
DateEE: >
.EE> ?
MonthEE? D
}EEE F
)EEF G
.FF 	
SelectFF	 
(FF 
gFF 
=>FF 
newFF 
{GG 	
MonthHH 
=HH 
$"HH 
{HH 
gHH 
.HH 
KeyHH 
.HH 
MonthHH "
}HH" #
$strHH# $
{HH$ %
gHH% &
.HH& '
KeyHH' *
.HH* +
YearHH+ /
}HH/ 0
"HH0 1
,HH1 2
VolumeII 
=II 
gII 
.II 
SumII 
(II 
cII 
=>II 
cII  !
.II! "
VolumeII" (
)II( )
}JJ 	
)JJ	 

.KK 	
OrderByKK	 
(KK 
gKK 
=>KK 
gKK 
.KK 
MonthKK 
)KK 
.LL 	
ToListLL	 
(LL 
)LL 
;LL 
varOO !
generalMonthlyAverageOO %
=OO& '
awaitOO( -
_contextOO. 6
.OO6 7
ConsumptionOO7 B
.PP 
GroupByPP 
(PP 
cPP 
=>PP 
newPP !
{PP" #
cPP$ %
.PP% &
DatePP& *
.PP* +
YearPP+ /
,PP/ 0
cPP1 2
.PP2 3
DatePP3 7
.PP7 8
MonthPP8 =
}PP> ?
)PP? @
.QQ 
SelectQQ 
(QQ 
gQQ 
=>QQ 
newQQ  
{RR 
MonthSS 
=SS 
newSS 
DateTimeSS  (
(SS( )
gSS) *
.SS* +
KeySS+ .
.SS. /
YearSS/ 3
,SS3 4
gSS5 6
.SS6 7
KeySS7 :
.SS: ;
MonthSS; @
,SS@ A
$numSSB C
)SSC D
,SSD E
AverageVolumeTT !
=TT" #
gTT$ %
.TT% &
AverageTT& -
(TT- .
cTT. /
=>TT0 2
cTT3 4
.TT4 5
VolumeTT5 ;
)TT; <
}UU 
)UU 
.VV 
ToDictionaryAsyncVV "
(VV" #
xVV# $
=>VV% '
xVV( )
.VV) *
MonthVV* /
.VV/ 0
ToStringVV0 8
(VV8 9
$strVV9 C
)VVC D
,VVD E
xVVF G
=>VVH J
MathVVK O
.VVO P
RoundVVP U
(VVU V
xVVV W
.VVW X
AverageVolumeVVX e
,VVe f
$numVVg h
)VVh i
)VVi j
;VVj k
ViewDataYY 
[YY 
$strYY &
]YY& '
=YY( )
userMonthlyDataYY* 9
;YY9 :
ViewDataZZ 
[ZZ 
$strZZ '
]ZZ' (
=ZZ) *!
generalMonthlyAverageZZ+ @
;ZZ@ A
ViewData[[ 
[[[ 
$str[[ )
][[) *
=[[+ ,
JsonConvert[[- 8
.[[8 9
SerializeObject[[9 H
([[H I
userMonthlyDatabar[[I [
)[[[ \
;[[\ ]
return]] 
View]] 
(]] 
userConsumptions]] (
)]]( )
;]]) *
}__ 
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
Detailshh) 0
(hh0 1
inthh1 4
?hh4 5
idhh6 8
)hh8 9
{ii 	
ifjj 
(jj 
idjj 
==jj 
nulljj 
||jj 
_contextjj &
.jj& '
Consumptionjj' 2
==jj3 5
nulljj6 :
)jj: ;
{kk 
returnll 
NotFoundll 
(ll  
)ll  !
;ll! "
}mm 
varoo 
consumptionoo 
=oo 
awaitoo #
_contextoo$ ,
.oo, -
Consumptionoo- 8
.pp 
FirstOrDefaultAsyncpp $
(pp$ %
mpp% &
=>pp' )
mpp* +
.pp+ ,
Idpp, .
==pp/ 1
idpp2 4
)pp4 5
;pp5 6
ifqq 
(qq 
consumptionqq 
==qq 
nullqq #
)qq# $
{rr 
returnss 
NotFoundss 
(ss  
)ss  !
;ss! "
}tt 
returnvv 
Viewvv 
(vv 
consumptionvv #
)vv# $
;vv$ %
}ww 	
publiczz 
IActionResultzz 
Createzz #
(zz# $
)zz$ %
{{{ 	
return|| 
View|| 
(|| 
)|| 
;|| 
}}} 	
[
 	
HttpPost
	 
]
 
[
 	&
ValidateAntiForgeryToken
	 !
]
! "
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
Create
) /
(
/ 0
[
0 1
Bind
1 5
(
5 6
$str
6 M
)
M N
]
N O
Consumption
P [
consumption
\ g
)
g h
{
 	
if
 
(
 

ModelState
 
.
 
IsValid
 "
)
" #
{
 
string
 
userId
 
=
 
User
  $
.
$ %
FindFirstValue
% 3
(
3 4

ClaimTypes
4 >
.
> ?
NameIdentifier
? M
)
M N
;
N O
consumption
 
.
 
UserId
 "
=
# $
userId
% +
;
+ ,
_context
 
.
 
Add
 
(
 
consumption
 (
)
( )
;
) *
await
 
_context
 
.
 
SaveChangesAsync
 /
(
/ 0
)
0 1
;
1 2
return
 
RedirectToAction
 '
(
' (
nameof
( .
(
. /
Index
/ 4
)
4 5
)
5 6
;
6 7
}
 
foreach
 
(
 
var
 

modelState
 #
in
$ &

ModelState
' 1
.
1 2
Values
2 8
)
8 9
{
 
foreach
 
(
 
var
 
error
 "
in
# %

modelState
& 0
.
0 1
Errors
1 7
)
7 8
{
 
Console
 
.
 
	WriteLine
 %
(
% &
error
& +
.
+ ,
ErrorMessage
, 8
)
8 9
;
9 :
}
 
}
 
return
 
View
 
(
 
consumption
 #
)
# $
;
$ %
}
 	
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
IActionResult
¢¢ '
>
¢¢' (
Edit
¢¢) -
(
¢¢- .
int
¢¢. 1
?
¢¢1 2
id
¢¢3 5
)
¢¢5 6
{
££ 	
if
¤¤ 
(
¤¤ 
id
¤¤ 
==
¤¤ 
null
¤¤ 
||
¤¤ 
_context
¤¤ &
.
¤¤& '
Consumption
¤¤' 2
==
¤¤3 5
null
¤¤6 :
)
¤¤: ;
{
¥¥ 
return
¦¦ 
NotFound
¦¦ 
(
¦¦  
)
¦¦  !
;
¦¦! "
}
§§ 
var
©© 
consumption
©© 
=
©© 
await
©© #
_context
©©$ ,
.
©©, -
Consumption
©©- 8
.
©©8 9
	FindAsync
©©9 B
(
©©B C
id
©©C E
)
©©E F
;
©©F G
if
ªª 
(
ªª 
consumption
ªª 
==
ªª 
null
ªª #
)
ªª# $
{
«« 
return
¬¬ 
NotFound
¬¬ 
(
¬¬  
)
¬¬  !
;
¬¬! "
}
­­ 
return
®® 
View
®® 
(
®® 
consumption
®® #
)
®®# $
;
®®$ %
}
¯¯ 	
[
´´ 	
HttpPost
´´	 
]
´´ 
[
µµ 	&
ValidateAntiForgeryToken
µµ	 !
]
µµ! "
public
¶¶ 
async
¶¶ 
Task
¶¶ 
<
¶¶ 
IActionResult
¶¶ '
>
¶¶' (
Edit
¶¶) -
(
¶¶- .
int
¶¶. 1
id
¶¶2 4
,
¶¶4 5
[
¶¶6 7
Bind
¶¶7 ;
(
¶¶; <
$str
¶¶< S
)
¶¶S T
]
¶¶T U
Consumption
¶¶V a
consumption
¶¶b m
)
¶¶m n
{
·· 	
if
¸¸ 
(
¸¸ 
id
¸¸ 
!=
¸¸ 
consumption
¸¸ !
.
¸¸! "
Id
¸¸" $
)
¸¸$ %
{
¹¹ 
return
ºº 
NotFound
ºº 
(
ºº  
)
ºº  !
;
ºº! "
}
»» 
if
½½ 
(
½½ 

ModelState
½½ 
.
½½ 
IsValid
½½ "
)
½½" #
{
¾¾ 
try
¿¿ 
{
ÀÀ 
_context
ÁÁ 
.
ÁÁ 
Update
ÁÁ #
(
ÁÁ# $
consumption
ÁÁ$ /
)
ÁÁ/ 0
;
ÁÁ0 1
await
ÂÂ 
_context
ÂÂ "
.
ÂÂ" #
SaveChangesAsync
ÂÂ# 3
(
ÂÂ3 4
)
ÂÂ4 5
;
ÂÂ5 6
}
ÃÃ 
catch
ÄÄ 
(
ÄÄ *
DbUpdateConcurrencyException
ÄÄ 3
)
ÄÄ3 4
{
ÅÅ 
if
ÆÆ 
(
ÆÆ 
!
ÆÆ 
ConsumptionExists
ÆÆ *
(
ÆÆ* +
consumption
ÆÆ+ 6
.
ÆÆ6 7
Id
ÆÆ7 9
)
ÆÆ9 :
)
ÆÆ: ;
{
ÇÇ 
return
ÈÈ 
NotFound
ÈÈ '
(
ÈÈ' (
)
ÈÈ( )
;
ÈÈ) *
}
ÉÉ 
else
ÊÊ 
{
ËË 
throw
ÌÌ 
;
ÌÌ 
}
ÍÍ 
}
ÎÎ 
return
ÏÏ 
RedirectToAction
ÏÏ '
(
ÏÏ' (
nameof
ÏÏ( .
(
ÏÏ. /
Index
ÏÏ/ 4
)
ÏÏ4 5
)
ÏÏ5 6
;
ÏÏ6 7
}
ÐÐ 
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
consumption
ÑÑ #
)
ÑÑ# $
;
ÑÑ$ %
}
ÒÒ 	
public
ÕÕ 
async
ÕÕ 
Task
ÕÕ 
<
ÕÕ 
IActionResult
ÕÕ '
>
ÕÕ' (
Delete
ÕÕ) /
(
ÕÕ/ 0
int
ÕÕ0 3
?
ÕÕ3 4
id
ÕÕ5 7
)
ÕÕ7 8
{
ÖÖ 	
if
×× 
(
×× 
id
×× 
==
×× 
null
×× 
||
×× 
_context
×× &
.
××& '
Consumption
××' 2
==
××3 5
null
××6 :
)
××: ;
{
ØØ 
return
ÙÙ 
NotFound
ÙÙ 
(
ÙÙ  
)
ÙÙ  !
;
ÙÙ! "
}
ÚÚ 
var
ÜÜ 
consumption
ÜÜ 
=
ÜÜ 
await
ÜÜ #
_context
ÜÜ$ ,
.
ÜÜ, -
Consumption
ÜÜ- 8
.
ÝÝ !
FirstOrDefaultAsync
ÝÝ $
(
ÝÝ$ %
m
ÝÝ% &
=>
ÝÝ' )
m
ÝÝ* +
.
ÝÝ+ ,
Id
ÝÝ, .
==
ÝÝ/ 1
id
ÝÝ2 4
)
ÝÝ4 5
;
ÝÝ5 6
if
ÞÞ 
(
ÞÞ 
consumption
ÞÞ 
==
ÞÞ 
null
ÞÞ #
)
ÞÞ# $
{
ßß 
return
àà 
NotFound
àà 
(
àà  
)
àà  !
;
àà! "
}
áá 
return
ãã 
View
ãã 
(
ãã 
consumption
ãã #
)
ãã# $
;
ãã$ %
}
ää 	
[
çç 	
HttpPost
çç	 
,
çç 

ActionName
çç 
(
çç 
$str
çç &
)
çç& '
]
çç' (
[
èè 	&
ValidateAntiForgeryToken
èè	 !
]
èè! "
public
éé 
async
éé 
Task
éé 
<
éé 
IActionResult
éé '
>
éé' (
DeleteConfirmed
éé) 8
(
éé8 9
int
éé9 <
id
éé= ?
)
éé? @
{
êê 	
if
ëë 
(
ëë 
_context
ëë 
.
ëë 
Consumption
ëë $
==
ëë% '
null
ëë( ,
)
ëë, -
{
ìì 
return
íí 
Problem
íí 
(
íí 
$str
íí X
)
ííX Y
;
ííY Z
}
îî 
var
ïï 
consumption
ïï 
=
ïï 
await
ïï #
_context
ïï$ ,
.
ïï, -
Consumption
ïï- 8
.
ïï8 9
	FindAsync
ïï9 B
(
ïïB C
id
ïïC E
)
ïïE F
;
ïïF G
if
ðð 
(
ðð 
consumption
ðð 
!=
ðð 
null
ðð #
)
ðð# $
{
ññ 
_context
òò 
.
òò 
Consumption
òò $
.
òò$ %
Remove
òò% +
(
òò+ ,
consumption
òò, 7
)
òò7 8
;
òò8 9
}
óó 
await
õõ 
_context
õõ 
.
õõ 
SaveChangesAsync
õõ +
(
õõ+ ,
)
õõ, -
;
õõ- .
return
öö 
RedirectToAction
öö #
(
öö# $
nameof
öö$ *
(
öö* +
Index
öö+ 0
)
öö0 1
)
öö1 2
;
öö2 3
}
÷÷ 	
private
ùù 
bool
ùù 
ConsumptionExists
ùù &
(
ùù& '
int
ùù' *
id
ùù+ -
)
ùù- .
{
úú 	
return
ûû 
(
ûû 
_context
ûû 
.
ûû 
Consumption
ûû (
?
ûû( )
.
ûû) *
Any
ûû* -
(
ûû- .
e
ûû. /
=>
ûû0 2
e
ûû3 4
.
ûû4 5
Id
ûû5 7
==
ûû8 :
id
ûû; =
)
ûû= >
)
ûû> ?
.
ûû? @
GetValueOrDefault
ûû@ Q
(
ûûQ R
)
ûûR S
;
ûûS T
}
üü 	
public
 
IActionResult
 
Advice
 #
(
# $
)
$ %
{
 	
return
 
View
 
(
 
)
 
;
 
}
 	
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (%
MonthlyConsumptionChart
) @
(
@ A
)
A B
{
 	
var
 
userId
 
=
 
_userManager
 %
.
% &
	GetUserId
& /
(
/ 0
User
0 4
)
4 5
;
5 6
var
 
userMonthlyData
 
=
  !
_context
" *
.
* +
Consumption
+ 6
.
 
Where
 
(
 
c
 
=>
 
c
 
.
 
UserId
 $
==
% '
userId
( .
)
. /
.
 
GroupBy
 
(
 
c
 
=>
 
new
 !
{
" #
c
$ %
.
% &
Date
& *
.
* +
Year
+ /
,
/ 0
c
1 2
.
2 3
Date
3 7
.
7 8
Month
8 =
}
> ?
)
? @
.
 
OrderBy
 
(
 
g
 
=>
 
g
 
.
  
Key
  #
.
# $
Year
$ (
)
( )
.
) *
ThenBy
* 0
(
0 1
g
1 2
=>
3 5
g
6 7
.
7 8
Key
8 ;
.
; <
Month
< A
)
A B
.
 
Select
 
(
 
g
 
=>
 
new
  
{
! "
Month
# (
=
) *
$"
+ -
{
- .
g
. /
.
/ 0
Key
0 3
.
3 4
Month
4 9
}
9 :
$str
: ;
{
; <
g
< =
.
= >
Key
> A
.
A B
Year
B F
}
F G
"
G H
,
H I
Volume
J P
=
Q R
g
S T
.
T U
Sum
U X
(
X Y
c
Y Z
=>
[ ]
c
^ _
.
_ `
Volume
` f
)
f g
}
h i
)
i j
;
j k
return
 
Json
 
(
 
userMonthlyData
 '
)
' (
;
( )
}
 	
}
 
} 